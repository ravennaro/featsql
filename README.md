# featsql

<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->

``` python
import pandas as pd
from sqlalchemy import create_engine
pd.set_option('display.max_columns', None)
```

This file will become your README and also the index of your
documentation.

## Install

``` sh
pip install featsql
```

## Configurando a engine

``` python
url_db = "sqlite:///../.data/mydatabase.db" 
engine = create_engine(url_db)
```

## Visão inicial do público

Primeiro vamos observar o formato da tabela spine

``` python
df_spine = pd.read_sql("SELECT * FROM tb_spine", engine)
df_spine.head()
```

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
&#10;    .dataframe tbody tr th {
        vertical-align: top;
    }
&#10;    .dataframe thead th {
        text-align: right;
    }
</style>

|     | ID  | SAFRA_REF  | Target |
|-----|-----|------------|--------|
| 0   | 4   | 2023-02-01 | 0      |
| 1   | 5   | 2023-02-01 | 0      |
| 2   | 6   | 2023-02-01 | 0      |
| 3   | 7   | 2023-02-01 | 0      |
| 4   | 10  | 2023-02-01 | 0      |

</div>

## Visão inicial da tabela de variáveis

A tabela de variáveis contém 3 variáveis, duas sendo numéricas e uma
categórica. Existem mais ID’s únicos e datas disponível nessa tabela do
que na tabela spine.

``` python
df_data = pd.read_sql("SELECT * FROM tb_feat", engine)
df_data.head()
```

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
&#10;    .dataframe tbody tr th {
        vertical-align: top;
    }
&#10;    .dataframe thead th {
        text-align: right;
    }
</style>

|     | ID  | SAFRA      | FEAT_NUM1 | FEAT_NUM2 | FEAT_CAT1 | FEAT_CAT2 |
|-----|-----|------------|-----------|-----------|-----------|-----------|
| 0   | 1   | 2023-01-01 | 33        | 15        | C         | B         |
| 1   | 2   | 2023-01-01 | -36       | 82        | C         | B         |
| 2   | 3   | 2023-01-01 | 89        | 33        | C         | B         |
| 3   | 4   | 2023-01-01 | -34       | -94       | C         | B         |
| 4   | 5   | 2023-01-01 | 99        | 26        | B         | B         |

</div>

## Criação de variáveis numéricas

``` python
tb_publico = 'tb_spine'
tb_feat = 'tb_feat'
id = 'ID'
safra_ref = 'SAFRA_REF'
safra = 'SAFRA'
target = 'Target'
feat_num_lista = ['FEAT_NUM1','FEAT_NUM2']
lista_janela = [1,2,3]
query_final_num = create_query_num(tb_publico, tb_feat, lista_janela,feat_num_lista, id, safra_ref, target, safra)
```

``` python
df_num = pd.read_sql(query_final_num, engine)
df_num.head()
```

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
&#10;    .dataframe tbody tr th {
        vertical-align: top;
    }
&#10;    .dataframe thead th {
        text-align: right;
    }
</style>

|     | ID  | SAFRA_REF  | Target | FEAT_NUM1_SUM_1M | FEAT_NUM1_MIN_1M | FEAT_NUM1_MAX_1M | FEAT_NUM1_AGV_1M | FEAT_NUM2_SUM_1M | FEAT_NUM2_MIN_1M | FEAT_NUM2_MAX_1M | FEAT_NUM2_AGV_1M | FEAT_NUM1_SUM_2M | FEAT_NUM1_MIN_2M | FEAT_NUM1_MAX_2M | FEAT_NUM1_AGV_2M | FEAT_NUM2_SUM_2M | FEAT_NUM2_MIN_2M | FEAT_NUM2_MAX_2M | FEAT_NUM2_AGV_2M | FEAT_NUM1_SUM_3M | FEAT_NUM1_MIN_3M | FEAT_NUM1_MAX_3M | FEAT_NUM1_AGV_3M | FEAT_NUM2_SUM_3M | FEAT_NUM2_MIN_3M | FEAT_NUM2_MAX_3M | FEAT_NUM2_AGV_3M |
|-----|-----|------------|--------|------------------|------------------|------------------|------------------|------------------|------------------|------------------|------------------|------------------|------------------|------------------|------------------|------------------|------------------|------------------|------------------|------------------|------------------|------------------|------------------|------------------|------------------|------------------|------------------|
| 0   | 4   | 2023-02-01 | 0      | -34              | -34              | -34              | -34.0            | -94              | -94              | -94              | -94.0            | -34              | -34              | -34              | -34.0            | -94              | -94              | -94              | -94.0            | -34              | -34              | -34              | -34.0            | -94              | -94              | -94              | -94.0            |
| 1   | 5   | 2023-02-01 | 0      | 99               | 99               | 99               | 99.0             | 26               | 26               | 26               | 26.0             | 99               | 99               | 99               | 99.0             | 26               | 26               | 26               | 26.0             | 99               | 99               | 99               | 99.0             | 26               | 26               | 26               | 26.0             |
| 2   | 6   | 2023-02-01 | 0      | 18               | 18               | 18               | 18.0             | -55              | -55              | -55              | -55.0            | 18               | 18               | 18               | 18.0             | -55              | -55              | -55              | -55.0            | 18               | 18               | 18               | 18.0             | -55              | -55              | -55              | -55.0            |
| 3   | 7   | 2023-02-01 | 0      | -44              | -44              | -44              | -44.0            | 4                | 4                | 4                | 4.0              | -44              | -44              | -44              | -44.0            | 4                | 4                | 4                | 4.0              | -44              | -44              | -44              | -44.0            | 4                | 4                | 4                | 4.0              |
| 4   | 10  | 2023-02-01 | 0      | 67               | 67               | 67               | 67.0             | 85               | 85               | 85               | 85.0             | 67               | 67               | 67               | 67.0             | 85               | 85               | 85               | 85.0             | 67               | 67               | 67               | 67.0             | 85               | 85               | 85               | 85.0             |

</div>

``` python
print(query_final_num)
```

    NameError: name 'query_final' is not defined

``` python
tb_publico = 'tb_spine'
tb_feat = 'tb_feat'
id = 'ID'
safra_ref = 'SAFRA_REF'
safra = 'SAFRA'
target = 'Target'
feat_num_lista = ['FEAT_CAT1','FEAT_CAT2']
lista_janela = [1,2,3]
query_final_cat = create_query_cat(tb_publico, tb_feat, lista_janela,feat_num_lista, id, safra_ref, target, safra)
```

    NameError: name 'create_query_cat' is not defined

``` python
df_cat = pd.read_sql(query_final_cat, engine)
df_cat.head()
```
