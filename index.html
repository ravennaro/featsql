<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.555">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="(EN) Create text to develop features with a time window structure in SQL for SQLite, MySQL, and Snowflake databases. This tool allows you to perform queries directly on the database, and it is also possible to save the query to a text file provided by the user.">

<title>featsql</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="styles.css">
<meta property="og:title" content="featsql">
<meta property="og:description" content="(EN) Create text to develop features with a time window structure in SQL for SQLite, MySQL, and Snowflake databases. This tool allows you to perform queries directly on the database, and it is also possible to save the query to a text file provided by the user.">
<meta property="og:site_name" content="featsql">
<meta name="twitter:title" content="featsql">
<meta name="twitter:description" content="(EN) Create text to develop features with a time window structure in SQL for SQLite, MySQL, and Snowflake databases. This tool allows you to perform queries directly on the database, and it is also possible to save the query to a text file provided by the user.">
<meta name="twitter:card" content="summary">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">featsql</span>
    </a>
  </div>
        <div class="quarto-navbar-tools tools-end">
</div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./index.html">featsql</a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">featsql</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./creation_sqlite.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Creation sqlite</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./creation_mysql.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Creation MySQL</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./creation_snowflake.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Creation Snowflake</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#install" id="toc-install" class="nav-link active" data-scroll-target="#install">Install</a></li>
  <li><a href="#imports" id="toc-imports" class="nav-link" data-scroll-target="#imports">Imports</a></li>
  <li><a href="#exemples" id="toc-exemples" class="nav-link" data-scroll-target="#exemples">Exemples</a>
  <ul class="collapse">
  <li><a href="#sqlite" id="toc-sqlite" class="nav-link" data-scroll-target="#sqlite">1. SQLITE</a>
  <ul class="collapse">
  <li><a href="#setting-up-the-engine-configurando-a-engine" id="toc-setting-up-the-engine-configurando-a-engine" class="nav-link" data-scroll-target="#setting-up-the-engine-configurando-a-engine">Setting up the engine (Configurando a engine)</a></li>
  <li><a href="#initial-view-of-the-public-visão-inicial-do-público" id="toc-initial-view-of-the-public-visão-inicial-do-público" class="nav-link" data-scroll-target="#initial-view-of-the-public-visão-inicial-do-público">Initial view of the public (Visão inicial do público)</a></li>
  <li><a href="#initial-view-of-the-variables-table-visão-inicial-da-tabela-de-variáveis" id="toc-initial-view-of-the-variables-table-visão-inicial-da-tabela-de-variáveis" class="nav-link" data-scroll-target="#initial-view-of-the-variables-table-visão-inicial-da-tabela-de-variáveis">Initial view of the variables table (Visão inicial da tabela de variáveis)</a></li>
  <li><a href="#creation-of-numerical-variables-criação-de-variáveis-numéricas" id="toc-creation-of-numerical-variables-criação-de-variáveis-numéricas" class="nav-link" data-scroll-target="#creation-of-numerical-variables-criação-de-variáveis-numéricas">Creation of numerical variables (Criação de variáveis numéricas)</a></li>
  <li><a href="#creation-of-categorical-variables-criação-de-variáveis-categóricas" id="toc-creation-of-categorical-variables-criação-de-variáveis-categóricas" class="nav-link" data-scroll-target="#creation-of-categorical-variables-criação-de-variáveis-categóricas">Creation of categorical variables (Criação de variáveis categóricas)</a></li>
  <li><a href="#creation-of-aggregated-variables-criação-de-variáveis-agregadas" id="toc-creation-of-aggregated-variables-criação-de-variáveis-agregadas" class="nav-link" data-scroll-target="#creation-of-aggregated-variables-criação-de-variáveis-agregadas">Creation of aggregated variables (Criação de variáveis agregadas)</a></li>
  </ul></li>
  <li><a href="#mysql" id="toc-mysql" class="nav-link" data-scroll-target="#mysql">2. MySQL</a>
  <ul class="collapse">
  <li><a href="#setting-up-the-connection-configurando-a-conexão" id="toc-setting-up-the-connection-configurando-a-conexão" class="nav-link" data-scroll-target="#setting-up-the-connection-configurando-a-conexão">Setting up the connection (Configurando a conexão)</a></li>
  <li><a href="#initial-view-of-the-public-visão-inicial-do-público-1" id="toc-initial-view-of-the-public-visão-inicial-do-público-1" class="nav-link" data-scroll-target="#initial-view-of-the-public-visão-inicial-do-público-1">Initial view of the public (Visão inicial do público)</a></li>
  <li><a href="#initial-view-of-the-variables-table-visão-inicial-da-tabela-de-variáveis-1" id="toc-initial-view-of-the-variables-table-visão-inicial-da-tabela-de-variáveis-1" class="nav-link" data-scroll-target="#initial-view-of-the-variables-table-visão-inicial-da-tabela-de-variáveis-1">Initial view of the variables table (Visão inicial da tabela de variáveis)</a></li>
  <li><a href="#creation-of-numerical-variables-criação-de-variáveis-numéricas-1" id="toc-creation-of-numerical-variables-criação-de-variáveis-numéricas-1" class="nav-link" data-scroll-target="#creation-of-numerical-variables-criação-de-variáveis-numéricas-1">Creation of numerical variables (Criação de variáveis numéricas)</a></li>
  <li><a href="#creation-of-categorical-variables-criação-de-variáveis-categóricas-1" id="toc-creation-of-categorical-variables-criação-de-variáveis-categóricas-1" class="nav-link" data-scroll-target="#creation-of-categorical-variables-criação-de-variáveis-categóricas-1">Creation of categorical variables (Criação de variáveis categóricas)</a></li>
  <li><a href="#creation-of-aggregated-variables-criação-de-variáveis-agregadas-1" id="toc-creation-of-aggregated-variables-criação-de-variáveis-agregadas-1" class="nav-link" data-scroll-target="#creation-of-aggregated-variables-criação-de-variáveis-agregadas-1">Creation of aggregated variables (Criação de variáveis agregadas)</a></li>
  </ul></li>
  <li><a href="#snowflake" id="toc-snowflake" class="nav-link" data-scroll-target="#snowflake">3. Snowflake</a>
  <ul class="collapse">
  <li><a href="#criação-de-variáveis-numéricas" id="toc-criação-de-variáveis-numéricas" class="nav-link" data-scroll-target="#criação-de-variáveis-numéricas">Criação de variáveis numéricas</a></li>
  <li><a href="#criação-de-variáveis-categóricas" id="toc-criação-de-variáveis-categóricas" class="nav-link" data-scroll-target="#criação-de-variáveis-categóricas">Criação de variáveis categóricas</a></li>
  <li><a href="#criação-de-variáveis-agregadas" id="toc-criação-de-variáveis-agregadas" class="nav-link" data-scroll-target="#criação-de-variáveis-agregadas">Criação de variáveis agregadas</a></li>
  </ul></li>
  </ul></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/ravennaro/featsql/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">featsql</h1>
</div>

<div>
  <div class="description">
    <span style="color: blue;">(EN)</span> <code>Create</code> text to develop features with a <code>time window structure</code> in <code>SQL</code> for <code>SQLite</code>, <code>MySQL</code>, and <code>Snowflake</code> databases. This tool allows you to perform queries directly on the database, and it is also possible to save the query to a text file provided by the user.
  </div>
</div>


<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->
<p><span style="color: blue;">(EN)</span> There are three kinds of functions that can be used to create features from numerical, categorical and aggregated data. They are:</p>
<ul>
<li><p>For the SQLite database:</p>
<ul>
<li><p><code>sqlite_create_query_num()</code>: Numerical variables such as mean, sum, etc., within the user-provided window of n months.</p></li>
<li><p><code>sqlite_create_query_cat()</code>: Categorical variables such as mean, sum, etc., within the user-provided window of n months.</p></li>
<li><p><code>sqlite_create_query_agregada()</code>: Numerical variables grouped by a specific categorical variable value with mean, sum, etc., within the user-provided window of n months.</p></li>
</ul></li>
<li><p>For the MySQL database:</p>
<ul>
<li><p><code>mysql_create_query_num()</code>: Numerical variables such as mean, sum, etc., within the user-provided window of n months.</p></li>
<li><p><code>mysql_create_query_cat()</code>: Categorical variables such as mean, sum, etc., within the user-provided window of n months.</p></li>
<li><p><code>mysql_create_query_agregada()</code>: Numerical variables grouped by a specific categorical variable value with mean, sum, etc., within the user-provided window of n months.</p></li>
</ul></li>
<li><p>For the Snowflake database:</p>
<ul>
<li><p><code>snow_create_query_num()</code>: Numerical variables such as mean, sum, etc., within the user-provided window of n months.</p></li>
<li><p><code>snow_create_query_cat()</code>: Categorical variables such as mean, sum, etc., within the user-provided window of n months.</p></li>
<li><p><code>snow_create_query_agregada()</code>: Numerical variables grouped by a specific categorical variable value with mean, sum, etc., within the user-provided window of n months.</p></li>
</ul></li>
</ul>
<p>Next, we have a detailed example for creating variables in SQLite and MySQL databases, along with an example output for the Snowflake database.</p>
<p><span style="color: green;">(PT)</span> Existem três tipos de funções que podem ser usadas para criar variáveis a partir de dados numéricos, categóricos e agregados. São elas: - Para o banco SQLite:</p>
<pre><code>+ ``sqlite_create_query_num()``: variáveis numéricas como média, soma e etc na janela de n meses fornecida pelo usuário.
+ ``sqlite_create_query_cat()``: variáveis categóricas como média, soma e etc na janela de n meses fornecida pelo usuário.
+ ``sqlite_create_query_agregada()``: variáveis numéricas agrupadas por uma valor específico de variável categórica com a média, soma e etc na janela de n meses fornecida pelo usuário.</code></pre>
<ul>
<li><p>Para o banco MySQL:</p>
<ul>
<li><code>mysql_create_query_num()</code>: variáveis numéricas como média, soma e etc na janela de n meses fornecida pelo usuário.</li>
<li><code>mysql_create_query_cat()</code>: variáveis categóricas como média, soma e etc na janela de n meses fornecida pelo usuário.</li>
<li><code>mysql_create_query_agregada()</code>: variáveis numéricas agrupadas por uma valor específico de variável categórica com a média, soma e etc na janela de n meses fornecida pelo usuário.</li>
</ul></li>
<li><p>Para o banco snowflake:</p>
<ul>
<li><p><code>snow_create_query_num()</code>: variáveis numéricas como média, soma e etc na janela de n meses fornecida pelo usuário.</p></li>
<li><p><code>snow_create_query_cat()</code>: variáveis categóricas como média, soma e etc na janela de n meses fornecida pelo usuário.</p></li>
<li><p><code>snow_create_query_agregada()</code>: variáveis numéricas agrupadas por uma valor específico de variável categórica com a média, soma e etc na janela de n meses fornecida pelo usuário.</p></li>
</ul></li>
</ul>
<p>A seguir, temos um exemplo detalhado para a criação de variáveis no banco sqlite e mysql. Além de um exemplo de output para o banco do tipo snowflake.</p>
<section id="install" class="level2">
<h2 class="anchored" data-anchor-id="install">Install</h2>
<p><span style="color: blue;">(EN)</span> To install, simply use the command line:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="ex">pip</span> install featsql</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><span style="color: green;">(PT)</span> Para instalar, simplesmente use o comando:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="ex">pip</span> install featsql</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="imports" class="level2">
<h2 class="anchored" data-anchor-id="imports">Imports</h2>
<div id="cell-8" class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> featsql.featsqlite <span class="im">import</span> <span class="op">*</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> featsql.featmysql <span class="im">import</span> <span class="op">*</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> featsql.featsnow <span class="im">import</span> <span class="op">*</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-9" class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-10" class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> mysql.connector</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sqlite3</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>pd.set_option(<span class="st">'display.max_columns'</span>, <span class="va">None</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="exemples" class="level1">
<h1>Exemples</h1>
<section id="sqlite" class="level2">
<h2 class="anchored" data-anchor-id="sqlite">1. SQLITE</h2>
<section id="setting-up-the-engine-configurando-a-engine" class="level3">
<h3 class="anchored" data-anchor-id="setting-up-the-engine-configurando-a-engine">Setting up the engine (Configurando a engine)</h3>
<div id="cell-14" class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>url_db <span class="op">=</span> <span class="st">"../../data/mydatabase.db"</span> </span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>conn <span class="op">=</span> sqlite3.<span class="ex">connect</span>(url_db)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>cursor <span class="op">=</span> conn.cursor()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="initial-view-of-the-public-visão-inicial-do-público" class="level3">
<h3 class="anchored" data-anchor-id="initial-view-of-the-public-visão-inicial-do-público">Initial view of the public (Visão inicial do público)</h3>
<p><span style="color: blue;">(EN)</span> First, let’s observe the format of the spine table.</p>
<p><span style="color: green;">(PT)</span> Primeiro vamos observar o formato da tabela spine</p>
<div id="cell-17" class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>df_spine <span class="op">=</span> pd.read_sql(<span class="st">"SELECT * FROM tb_spine"</span>, conn)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>df_spine.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ID</th>
<th data-quarto-table-cell-role="th">SAFRA_REF</th>
<th data-quarto-table-cell-role="th">Target</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>4</td>
<td>2023-02-01</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>5</td>
<td>2023-02-01</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>6</td>
<td>2023-02-01</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>7</td>
<td>2023-02-01</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>10</td>
<td>2023-02-01</td>
<td>1</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="initial-view-of-the-variables-table-visão-inicial-da-tabela-de-variáveis" class="level3">
<h3 class="anchored" data-anchor-id="initial-view-of-the-variables-table-visão-inicial-da-tabela-de-variáveis">Initial view of the variables table (Visão inicial da tabela de variáveis)</h3>
<p><span style="color: blue;">(EN)</span> The table tb_feat contains 4 variables, two numeric and two categorical. Note that there are more unique IDs and dates available in this than in the spine table, as is often the case.</p>
<p><span style="color: green;">(PT)</span> A tabela tb_feat contém 4 variáveis, duas sendo numéricas e duas categórica. Perceba que existem mais ID’s únicos e datas disponíveis nessa tabela do que na tabela spine, caso que ocorre no dia a dia.</p>
<div id="cell-20" class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>df_data <span class="op">=</span> pd.read_sql(<span class="st">"SELECT * FROM tb_feat"</span>, conn)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>df_data.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ID</th>
<th data-quarto-table-cell-role="th">SAFRA</th>
<th data-quarto-table-cell-role="th">FEAT_NUM1</th>
<th data-quarto-table-cell-role="th">FEAT_NUM2</th>
<th data-quarto-table-cell-role="th">FEAT_CAT1</th>
<th data-quarto-table-cell-role="th">FEAT_CAT2</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1</td>
<td>2023-01-01</td>
<td>-19</td>
<td>-52</td>
<td>A</td>
<td>B</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2</td>
<td>2023-01-01</td>
<td>-7</td>
<td>-33</td>
<td>A</td>
<td>B</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>3</td>
<td>2023-01-01</td>
<td>6</td>
<td>91</td>
<td>C</td>
<td>C</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>4</td>
<td>2023-01-01</td>
<td>74</td>
<td>52</td>
<td>B</td>
<td>A</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>5</td>
<td>2023-01-01</td>
<td>79</td>
<td>77</td>
<td>B</td>
<td>B</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="creation-of-numerical-variables-criação-de-variáveis-numéricas" class="level3">
<h3 class="anchored" data-anchor-id="creation-of-numerical-variables-criação-de-variáveis-numéricas">Creation of numerical variables (Criação de variáveis numéricas)</h3>
<p><span style="color: blue;">(EN)</span> The function sqlite_create_query_num() creates a query text for generating variables with the sum, minimum, maximum, and average operations on the variables listed in feat_num_lista and within the time window listed in list_window.</p>
<p><span style="color: green;">(PT)</span> A função sqlite_create_query_num() cria um texto com a query para a criação de variáveis com as operações soma, mínimo, máximo e média das variáveis listadas em feat_num_lista e com a janela de tempo listada em list_window.</p>
<div id="cell-23" class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>tb_publico <span class="op">=</span> <span class="st">'tb_spine'</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>tb_feat <span class="op">=</span> <span class="st">'tb_feat'</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="bu">id</span> <span class="op">=</span> <span class="st">'ID'</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>safra_ref <span class="op">=</span> <span class="st">'SAFRA_REF'</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>safra <span class="op">=</span> <span class="st">'SAFRA'</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>feat_num_lista <span class="op">=</span> [<span class="st">'FEAT_NUM1'</span>,<span class="st">'FEAT_NUM2'</span>]</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>list_window <span class="op">=</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>]</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>query_final_num_sqlite <span class="op">=</span> sqlite_create_query_num(tb_publico, tb_feat, list_window, feat_num_lista, <span class="bu">id</span>, safra_ref, safra)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Complete query creation with no saved file.</code></pre>
</div>
</div>
<div id="cell-24" class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>df_num_sqlite <span class="op">=</span> pd.read_sql(query_final_num_sqlite, conn)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>df_num_sqlite.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ID</th>
<th data-quarto-table-cell-role="th">SAFRA_REF</th>
<th data-quarto-table-cell-role="th">FEAT_NUM1_SUM_1M</th>
<th data-quarto-table-cell-role="th">FEAT_NUM1_MIN_1M</th>
<th data-quarto-table-cell-role="th">FEAT_NUM1_MAX_1M</th>
<th data-quarto-table-cell-role="th">FEAT_NUM1_AVG_1M</th>
<th data-quarto-table-cell-role="th">FEAT_NUM2_SUM_1M</th>
<th data-quarto-table-cell-role="th">FEAT_NUM2_MIN_1M</th>
<th data-quarto-table-cell-role="th">FEAT_NUM2_MAX_1M</th>
<th data-quarto-table-cell-role="th">FEAT_NUM2_AVG_1M</th>
<th data-quarto-table-cell-role="th">FEAT_NUM1_SUM_2M</th>
<th data-quarto-table-cell-role="th">FEAT_NUM1_MIN_2M</th>
<th data-quarto-table-cell-role="th">FEAT_NUM1_MAX_2M</th>
<th data-quarto-table-cell-role="th">FEAT_NUM1_AVG_2M</th>
<th data-quarto-table-cell-role="th">FEAT_NUM2_SUM_2M</th>
<th data-quarto-table-cell-role="th">FEAT_NUM2_MIN_2M</th>
<th data-quarto-table-cell-role="th">FEAT_NUM2_MAX_2M</th>
<th data-quarto-table-cell-role="th">FEAT_NUM2_AVG_2M</th>
<th data-quarto-table-cell-role="th">FEAT_NUM1_SUM_3M</th>
<th data-quarto-table-cell-role="th">FEAT_NUM1_MIN_3M</th>
<th data-quarto-table-cell-role="th">FEAT_NUM1_MAX_3M</th>
<th data-quarto-table-cell-role="th">FEAT_NUM1_AVG_3M</th>
<th data-quarto-table-cell-role="th">FEAT_NUM2_SUM_3M</th>
<th data-quarto-table-cell-role="th">FEAT_NUM2_MIN_3M</th>
<th data-quarto-table-cell-role="th">FEAT_NUM2_MAX_3M</th>
<th data-quarto-table-cell-role="th">FEAT_NUM2_AVG_3M</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>4</td>
<td>2023-02-01</td>
<td>74.0</td>
<td>74.0</td>
<td>74.0</td>
<td>74.0</td>
<td>52.0</td>
<td>52.0</td>
<td>52.0</td>
<td>52.0</td>
<td>74</td>
<td>74</td>
<td>74</td>
<td>74.0</td>
<td>52</td>
<td>52</td>
<td>52</td>
<td>52.0</td>
<td>74</td>
<td>74</td>
<td>74</td>
<td>74.0</td>
<td>52</td>
<td>52</td>
<td>52</td>
<td>52.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>5</td>
<td>2023-02-01</td>
<td>79.0</td>
<td>79.0</td>
<td>79.0</td>
<td>79.0</td>
<td>77.0</td>
<td>77.0</td>
<td>77.0</td>
<td>77.0</td>
<td>79</td>
<td>79</td>
<td>79</td>
<td>79.0</td>
<td>77</td>
<td>77</td>
<td>77</td>
<td>77.0</td>
<td>79</td>
<td>79</td>
<td>79</td>
<td>79.0</td>
<td>77</td>
<td>77</td>
<td>77</td>
<td>77.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>6</td>
<td>2023-02-01</td>
<td>-13.0</td>
<td>-13.0</td>
<td>-13.0</td>
<td>-13.0</td>
<td>-45.0</td>
<td>-45.0</td>
<td>-45.0</td>
<td>-45.0</td>
<td>-13</td>
<td>-13</td>
<td>-13</td>
<td>-13.0</td>
<td>-45</td>
<td>-45</td>
<td>-45</td>
<td>-45.0</td>
<td>-13</td>
<td>-13</td>
<td>-13</td>
<td>-13.0</td>
<td>-45</td>
<td>-45</td>
<td>-45</td>
<td>-45.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>7</td>
<td>2023-02-01</td>
<td>-44.0</td>
<td>-44.0</td>
<td>-44.0</td>
<td>-44.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>-44</td>
<td>-44</td>
<td>-44</td>
<td>-44.0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0.0</td>
<td>-44</td>
<td>-44</td>
<td>-44</td>
<td>-44.0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>10</td>
<td>2023-02-01</td>
<td>11.0</td>
<td>11.0</td>
<td>11.0</td>
<td>11.0</td>
<td>-39.0</td>
<td>-39.0</td>
<td>-39.0</td>
<td>-39.0</td>
<td>11</td>
<td>11</td>
<td>11</td>
<td>11.0</td>
<td>-39</td>
<td>-39</td>
<td>-39</td>
<td>-39.0</td>
<td>11</td>
<td>11</td>
<td>11</td>
<td>11.0</td>
<td>-39</td>
<td>-39</td>
<td>-39</td>
<td>-39.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p><span style="color: blue;">(EN)</span> We can use the <code>nome_arquivo</code> parameter with a name in the format ‘table.sql’ to save the creation query in a file in the same folder where it is executed.</p>
<p><span style="color: green;">(PT)</span> Podemos utilizar o parâmetro <code>nome_arquivo</code> com um nome no formato “table.sql” para salvar query de criação em um arquivo na mesma pasta que é executado.</p>
<div id="cell-26" class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>tb_publico <span class="op">=</span> <span class="st">'tb_spine'</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>tb_feat <span class="op">=</span> <span class="st">'tb_feat'</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="bu">id</span> <span class="op">=</span> <span class="st">'ID'</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>safra_ref <span class="op">=</span> <span class="st">'SAFRA_REF'</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>safra <span class="op">=</span> <span class="st">'SAFRA'</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>feat_num_lista <span class="op">=</span> [<span class="st">'FEAT_NUM1'</span>,<span class="st">'FEAT_NUM2'</span>]</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>list_window <span class="op">=</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>]</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>file_name <span class="op">=</span> <span class="st">'table.sql'</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>query_final_num_sqlite <span class="op">=</span> sqlite_create_query_num(tb_publico, tb_feat, list_window, feat_num_lista, <span class="bu">id</span>, safra_ref, safra, file_name)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Complete query creation with table.sql saved file</code></pre>
</div>
</div>
<p><span style="color: blue;">(EN)</span> Besides saving the query to a file, we can create a table directly in the database using the <code>[</code>sqlite_create_query_num<code>](https://ravennaro.github.io/featsql/creation_sqlite.html#sqlite_create_query_num)</code> function with the creation parameters. Here is an example:</p>
<p><span style="color: green;">(PT)</span> Além de salvar a query em um arquivo, podemos criar uma tabela diretamente no banco de dados a partir da função <code>[</code>sqlite_create_query_num<code>](https://ravennaro.github.io/featsql/creation_sqlite.html#sqlite_create_query_num)</code> com os parâmetros de criação. A seguir um exemplo:</p>
<div id="cell-28" class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>tb_publico <span class="op">=</span> <span class="st">'tb_spine'</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>tb_feat <span class="op">=</span> <span class="st">'tb_feat'</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="bu">id</span> <span class="op">=</span> <span class="st">'ID'</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>safra_ref <span class="op">=</span> <span class="st">'SAFRA_REF'</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>safra <span class="op">=</span> <span class="st">'SAFRA'</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>feat_num_lista <span class="op">=</span> [<span class="st">'FEAT_NUM1'</span>,<span class="st">'FEAT_NUM2'</span>]</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>list_window <span class="op">=</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>]</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>status <span class="op">=</span> <span class="va">True</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>table_name <span class="op">=</span> <span class="st">'nome_da_tabela_criada'</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>file_name <span class="op">=</span> <span class="st">'table.sql'</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>query_final_num_sqlite <span class="op">=</span> sqlite_create_query_num(tb_publico, tb_feat, list_window, feat_num_lista, <span class="bu">id</span>, safra_ref, safra, file_name<span class="op">=</span>file_name, status<span class="op">=</span>status, table_name<span class="op">=</span>table_name, conn<span class="op">=</span>conn)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Complete query creation with table.sql saved file</code></pre>
</div>
</div>
<p><span style="color: blue;">(EN)</span> To verify the creation, let’s check the database table using the name of the created table:</p>
<p><span style="color: green;">(PT)</span> Para conferir a criação, vamos consultar o banco de dados com o nome da tabela que foi criada:</p>
<div id="cell-30" class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>query<span class="op">=</span><span class="ss">f"""SELECT  * from </span><span class="sc">{</span>table_name<span class="sc">}</span><span class="ss">"""</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_sql(query, conn)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ID</th>
<th data-quarto-table-cell-role="th">SAFRA_REF</th>
<th data-quarto-table-cell-role="th">FEAT_NUM1_SUM_1M</th>
<th data-quarto-table-cell-role="th">FEAT_NUM1_MIN_1M</th>
<th data-quarto-table-cell-role="th">FEAT_NUM1_MAX_1M</th>
<th data-quarto-table-cell-role="th">FEAT_NUM1_AVG_1M</th>
<th data-quarto-table-cell-role="th">FEAT_NUM2_SUM_1M</th>
<th data-quarto-table-cell-role="th">FEAT_NUM2_MIN_1M</th>
<th data-quarto-table-cell-role="th">FEAT_NUM2_MAX_1M</th>
<th data-quarto-table-cell-role="th">FEAT_NUM2_AVG_1M</th>
<th data-quarto-table-cell-role="th">FEAT_NUM1_SUM_2M</th>
<th data-quarto-table-cell-role="th">FEAT_NUM1_MIN_2M</th>
<th data-quarto-table-cell-role="th">FEAT_NUM1_MAX_2M</th>
<th data-quarto-table-cell-role="th">FEAT_NUM1_AVG_2M</th>
<th data-quarto-table-cell-role="th">FEAT_NUM2_SUM_2M</th>
<th data-quarto-table-cell-role="th">FEAT_NUM2_MIN_2M</th>
<th data-quarto-table-cell-role="th">FEAT_NUM2_MAX_2M</th>
<th data-quarto-table-cell-role="th">FEAT_NUM2_AVG_2M</th>
<th data-quarto-table-cell-role="th">FEAT_NUM1_SUM_3M</th>
<th data-quarto-table-cell-role="th">FEAT_NUM1_MIN_3M</th>
<th data-quarto-table-cell-role="th">FEAT_NUM1_MAX_3M</th>
<th data-quarto-table-cell-role="th">FEAT_NUM1_AVG_3M</th>
<th data-quarto-table-cell-role="th">FEAT_NUM2_SUM_3M</th>
<th data-quarto-table-cell-role="th">FEAT_NUM2_MIN_3M</th>
<th data-quarto-table-cell-role="th">FEAT_NUM2_MAX_3M</th>
<th data-quarto-table-cell-role="th">FEAT_NUM2_AVG_3M</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>4</td>
<td>2023-02-01</td>
<td>74.0</td>
<td>74.0</td>
<td>74.0</td>
<td>74.0</td>
<td>52.0</td>
<td>52.0</td>
<td>52.0</td>
<td>52.0</td>
<td>74.0</td>
<td>74.0</td>
<td>74.0</td>
<td>74.0</td>
<td>52.0</td>
<td>52.0</td>
<td>52.0</td>
<td>52.0</td>
<td>74.0</td>
<td>74.0</td>
<td>74.0</td>
<td>74.0</td>
<td>52.0</td>
<td>52.0</td>
<td>52.0</td>
<td>52.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>5</td>
<td>2023-02-01</td>
<td>79.0</td>
<td>79.0</td>
<td>79.0</td>
<td>79.0</td>
<td>77.0</td>
<td>77.0</td>
<td>77.0</td>
<td>77.0</td>
<td>79.0</td>
<td>79.0</td>
<td>79.0</td>
<td>79.0</td>
<td>77.0</td>
<td>77.0</td>
<td>77.0</td>
<td>77.0</td>
<td>79.0</td>
<td>79.0</td>
<td>79.0</td>
<td>79.0</td>
<td>77.0</td>
<td>77.0</td>
<td>77.0</td>
<td>77.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>6</td>
<td>2023-02-01</td>
<td>-13.0</td>
<td>-13.0</td>
<td>-13.0</td>
<td>-13.0</td>
<td>-45.0</td>
<td>-45.0</td>
<td>-45.0</td>
<td>-45.0</td>
<td>-13.0</td>
<td>-13.0</td>
<td>-13.0</td>
<td>-13.0</td>
<td>-45.0</td>
<td>-45.0</td>
<td>-45.0</td>
<td>-45.0</td>
<td>-13.0</td>
<td>-13.0</td>
<td>-13.0</td>
<td>-13.0</td>
<td>-45.0</td>
<td>-45.0</td>
<td>-45.0</td>
<td>-45.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>7</td>
<td>2023-02-01</td>
<td>-44.0</td>
<td>-44.0</td>
<td>-44.0</td>
<td>-44.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>-44.0</td>
<td>-44.0</td>
<td>-44.0</td>
<td>-44.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>-44.0</td>
<td>-44.0</td>
<td>-44.0</td>
<td>-44.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>10</td>
<td>2023-02-01</td>
<td>11.0</td>
<td>11.0</td>
<td>11.0</td>
<td>11.0</td>
<td>-39.0</td>
<td>-39.0</td>
<td>-39.0</td>
<td>-39.0</td>
<td>11.0</td>
<td>11.0</td>
<td>11.0</td>
<td>11.0</td>
<td>-39.0</td>
<td>-39.0</td>
<td>-39.0</td>
<td>-39.0</td>
<td>11.0</td>
<td>11.0</td>
<td>11.0</td>
<td>11.0</td>
<td>-39.0</td>
<td>-39.0</td>
<td>-39.0</td>
<td>-39.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="creation-of-categorical-variables-criação-de-variáveis-categóricas" class="level3">
<h3 class="anchored" data-anchor-id="creation-of-categorical-variables-criação-de-variáveis-categóricas">Creation of categorical variables (Criação de variáveis categóricas)</h3>
<p><span style="color: blue;">(EN)</span> The function <code>sqlite_create_query_cat()</code> generates a query text for creating variables with the mode of each variable listed in feat_num_lista within the time window provided in list_window.</p>
<p><span style="color: green;">(PT)</span> A função <code>sqlite_create_query_cat()</code> cria um texto com a query para a criação de variáveis com a moda de cada uma das variáveis listadas em feat_num_lista na janela de tempo fornecida em list_window.</p>
<div id="cell-33" class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>tb_publico <span class="op">=</span> <span class="st">'tb_spine'</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>tb_feat <span class="op">=</span> <span class="st">'tb_feat'</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="bu">id</span> <span class="op">=</span> <span class="st">'ID'</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>safra_ref <span class="op">=</span> <span class="st">'SAFRA_REF'</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>safra <span class="op">=</span> <span class="st">'SAFRA'</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>feat_num_lista <span class="op">=</span> [<span class="st">'FEAT_CAT1'</span>, <span class="st">'FEAT_CAT2'</span>]</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>list_window <span class="op">=</span> [<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">6</span>]</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>query_final_cat_sqlite <span class="op">=</span> sqlite_create_query_cat(tb_publico, tb_feat, list_window, feat_num_lista, <span class="bu">id</span>, safra_ref, safra)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Complete query creation with no saved file.</code></pre>
</div>
</div>
<div id="cell-34" class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>df_cat_sqlite_sqlite <span class="op">=</span> pd.read_sql(query_final_cat_sqlite, conn)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>df_cat_sqlite_sqlite.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ID</th>
<th data-quarto-table-cell-role="th">SAFRA_REF</th>
<th data-quarto-table-cell-role="th">FEAT_CAT1_MODA_1M</th>
<th data-quarto-table-cell-role="th">FEAT_CAT2_MODA_1M</th>
<th data-quarto-table-cell-role="th">FEAT_CAT1_MODA_3M</th>
<th data-quarto-table-cell-role="th">FEAT_CAT2_MODA_3M</th>
<th data-quarto-table-cell-role="th">FEAT_CAT1_MODA_6M</th>
<th data-quarto-table-cell-role="th">FEAT_CAT2_MODA_6M</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>4</td>
<td>2023-02-01</td>
<td>B</td>
<td>A</td>
<td>B</td>
<td>A</td>
<td>B</td>
<td>A</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>5</td>
<td>2023-02-01</td>
<td>B</td>
<td>B</td>
<td>B</td>
<td>B</td>
<td>B</td>
<td>B</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>6</td>
<td>2023-02-01</td>
<td>C</td>
<td>B</td>
<td>C</td>
<td>B</td>
<td>C</td>
<td>B</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>7</td>
<td>2023-02-01</td>
<td>B</td>
<td>C</td>
<td>B</td>
<td>C</td>
<td>B</td>
<td>C</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>10</td>
<td>2023-02-01</td>
<td>A</td>
<td>A</td>
<td>A</td>
<td>A</td>
<td>A</td>
<td>A</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p><span style="color: blue;">(EN)</span> The function <code>sqlite_create_query_cat()</code> also allows saving a file with the created query and creating the table directly in the database. Here’s an example:</p>
<p><span style="color: green;">(PT)</span> A função <code>sqlite_create_query_cat()</code> também permite salvar um arquivo com a query criada e criar a tabela diretamente no banco de dados. Segue um exemplo:</p>
<div id="cell-36" class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>tb_publico <span class="op">=</span> <span class="st">'tb_spine'</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>tb_feat <span class="op">=</span> <span class="st">'tb_feat'</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="bu">id</span> <span class="op">=</span> <span class="st">'ID'</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>safra_ref <span class="op">=</span> <span class="st">'SAFRA_REF'</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>safra <span class="op">=</span> <span class="st">'SAFRA'</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>feat_num_lista <span class="op">=</span> [<span class="st">'FEAT_CAT1'</span>, <span class="st">'FEAT_CAT2'</span>]</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>list_window <span class="op">=</span> [<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">6</span>]</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>status <span class="op">=</span> <span class="va">True</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>table_name <span class="op">=</span> <span class="st">'nome_da_tabela_criada'</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>file_name <span class="op">=</span> <span class="st">'table.sql'</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>query_final_cat_sqlite <span class="op">=</span> sqlite_create_query_cat(tb_publico, tb_feat, list_window, feat_num_lista, <span class="bu">id</span>, safra_ref, safra, file_name<span class="op">=</span>file_name, status<span class="op">=</span>status, table_name<span class="op">=</span>table_name, conn<span class="op">=</span>conn)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Complete query creation with table.sql saved file</code></pre>
</div>
</div>
<p><span style="color: blue;">(EN)</span> To verify the creation, let’s check the database table using the name of the created table:</p>
<p><span style="color: green;">(PT)</span> Para conferir a criação, vamos consultar o banco de dados com o nome da tabela que foi criada:</p>
<div id="cell-38" class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>query<span class="op">=</span><span class="ss">f"""SELECT  * from </span><span class="sc">{</span>table_name<span class="sc">}</span><span class="ss">"""</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_sql(query, conn)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ID</th>
<th data-quarto-table-cell-role="th">SAFRA_REF</th>
<th data-quarto-table-cell-role="th">FEAT_CAT1_MODA_1M</th>
<th data-quarto-table-cell-role="th">FEAT_CAT2_MODA_1M</th>
<th data-quarto-table-cell-role="th">FEAT_CAT1_MODA_3M</th>
<th data-quarto-table-cell-role="th">FEAT_CAT2_MODA_3M</th>
<th data-quarto-table-cell-role="th">FEAT_CAT1_MODA_6M</th>
<th data-quarto-table-cell-role="th">FEAT_CAT2_MODA_6M</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>4</td>
<td>2023-02-01</td>
<td>B</td>
<td>A</td>
<td>B</td>
<td>A</td>
<td>B</td>
<td>A</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>5</td>
<td>2023-02-01</td>
<td>B</td>
<td>B</td>
<td>B</td>
<td>B</td>
<td>B</td>
<td>B</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>6</td>
<td>2023-02-01</td>
<td>C</td>
<td>B</td>
<td>C</td>
<td>B</td>
<td>C</td>
<td>B</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>7</td>
<td>2023-02-01</td>
<td>B</td>
<td>C</td>
<td>B</td>
<td>C</td>
<td>B</td>
<td>C</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>10</td>
<td>2023-02-01</td>
<td>A</td>
<td>A</td>
<td>A</td>
<td>A</td>
<td>A</td>
<td>A</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="creation-of-aggregated-variables-criação-de-variáveis-agregadas" class="level3">
<h3 class="anchored" data-anchor-id="creation-of-aggregated-variables-criação-de-variáveis-agregadas">Creation of aggregated variables (Criação de variáveis agregadas)</h3>
<p><span style="color: blue;">(EN)</span> We can create features by aggregating on a specific value of a categorical variable and calculating sum, avg, min, and max operations for user-defined numerical variables. For example, for the variable FEAT_CAT1 having a value of A or B, we calculate sum, avg, min, and max operations for the variables FEAT_NUM1 and FEAT_NUM2. Here’s a use case:</p>
<p><span style="color: green;">(PT)</span> Podemos criar variáveis agregando por valor específico de variável categórica e calculando as operações de sum, avg, min e max para as variáveis númericas definidas pelo usuário. Por exemplo, para a variável <code>FEAT_CAT1</code> tendo valor igual a <code>A</code> ou <code>B</code>, calculamos as operações de sum, avg, min e max para as variáveis <code>FEAT_NUM1</code> e <code>FEAT_NUM2</code>. Segue um caso de uso:</p>
<div id="cell-41" class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>tb_publico <span class="op">=</span> <span class="st">'tb_spine'</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>list_window <span class="op">=</span> [<span class="dv">3</span>, <span class="dv">6</span>]</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>lista_feat_num <span class="op">=</span> [<span class="st">'FEAT_NUM1'</span>, <span class="st">'FEAT_NUM2'</span>]</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>feat_cat <span class="op">=</span> <span class="st">'FEAT_CAT1'</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>list_aggregator_value <span class="op">=</span> [<span class="st">'A'</span>, <span class="st">'B'</span>]</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="bu">id</span> <span class="op">=</span> <span class="st">'ID'</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>safra_ref <span class="op">=</span> <span class="st">'SAFRA_REF'</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>tb_feat <span class="op">=</span> <span class="st">'tb_feat'</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>safra <span class="op">=</span> <span class="st">'SAFRA'</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>query <span class="op">=</span> sqlite_create_query_agregada(tb_publico, tb_feat, list_window, lista_feat_num, <span class="bu">id</span>, safra_ref, safra, feat_cat, list_aggregator_value)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Complete query creation with no saved file.</code></pre>
</div>
</div>
<div id="cell-42" class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>df_sqlite_agregada <span class="op">=</span> pd.read_sql(query, conn)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>df_sqlite_agregada.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ID</th>
<th data-quarto-table-cell-role="th">SAFRA_REF</th>
<th data-quarto-table-cell-role="th">SUM_FEAT_NUM1_FEAT_CAT1_A_3M</th>
<th data-quarto-table-cell-role="th">MAX_FEAT_NUM1_FEAT_CAT1_A_3M</th>
<th data-quarto-table-cell-role="th">MIN_FEAT_NUM1_FEAT_CAT1_A_3M</th>
<th data-quarto-table-cell-role="th">AVG_FEAT_NUM1_FEAT_CAT1_A_3M</th>
<th data-quarto-table-cell-role="th">SUM_FEAT_NUM2_FEAT_CAT1_A_3M</th>
<th data-quarto-table-cell-role="th">MAX_FEAT_NUM2_FEAT_CAT1_A_3M</th>
<th data-quarto-table-cell-role="th">MIN_FEAT_NUM2_FEAT_CAT1_A_3M</th>
<th data-quarto-table-cell-role="th">AVG_FEAT_NUM2_FEAT_CAT1_A_3M</th>
<th data-quarto-table-cell-role="th">SUM_FEAT_NUM1_FEAT_CAT1_A_6M</th>
<th data-quarto-table-cell-role="th">MAX_FEAT_NUM1_FEAT_CAT1_A_6M</th>
<th data-quarto-table-cell-role="th">MIN_FEAT_NUM1_FEAT_CAT1_A_6M</th>
<th data-quarto-table-cell-role="th">AVG_FEAT_NUM1_FEAT_CAT1_A_6M</th>
<th data-quarto-table-cell-role="th">SUM_FEAT_NUM2_FEAT_CAT1_A_6M</th>
<th data-quarto-table-cell-role="th">MAX_FEAT_NUM2_FEAT_CAT1_A_6M</th>
<th data-quarto-table-cell-role="th">MIN_FEAT_NUM2_FEAT_CAT1_A_6M</th>
<th data-quarto-table-cell-role="th">AVG_FEAT_NUM2_FEAT_CAT1_A_6M</th>
<th data-quarto-table-cell-role="th">SUM_FEAT_NUM1_FEAT_CAT1_B_3M</th>
<th data-quarto-table-cell-role="th">MAX_FEAT_NUM1_FEAT_CAT1_B_3M</th>
<th data-quarto-table-cell-role="th">MIN_FEAT_NUM1_FEAT_CAT1_B_3M</th>
<th data-quarto-table-cell-role="th">AVG_FEAT_NUM1_FEAT_CAT1_B_3M</th>
<th data-quarto-table-cell-role="th">SUM_FEAT_NUM2_FEAT_CAT1_B_3M</th>
<th data-quarto-table-cell-role="th">MAX_FEAT_NUM2_FEAT_CAT1_B_3M</th>
<th data-quarto-table-cell-role="th">MIN_FEAT_NUM2_FEAT_CAT1_B_3M</th>
<th data-quarto-table-cell-role="th">AVG_FEAT_NUM2_FEAT_CAT1_B_3M</th>
<th data-quarto-table-cell-role="th">SUM_FEAT_NUM1_FEAT_CAT1_B_6M</th>
<th data-quarto-table-cell-role="th">MAX_FEAT_NUM1_FEAT_CAT1_B_6M</th>
<th data-quarto-table-cell-role="th">MIN_FEAT_NUM1_FEAT_CAT1_B_6M</th>
<th data-quarto-table-cell-role="th">AVG_FEAT_NUM1_FEAT_CAT1_B_6M</th>
<th data-quarto-table-cell-role="th">SUM_FEAT_NUM2_FEAT_CAT1_B_6M</th>
<th data-quarto-table-cell-role="th">MAX_FEAT_NUM2_FEAT_CAT1_B_6M</th>
<th data-quarto-table-cell-role="th">MIN_FEAT_NUM2_FEAT_CAT1_B_6M</th>
<th data-quarto-table-cell-role="th">AVG_FEAT_NUM2_FEAT_CAT1_B_6M</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>4</td>
<td>2023-02-01</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>74.0</td>
<td>74.0</td>
<td>74.0</td>
<td>74.0</td>
<td>52.0</td>
<td>52.0</td>
<td>52.0</td>
<td>52.0</td>
<td>74.0</td>
<td>74.0</td>
<td>74.0</td>
<td>74.0</td>
<td>52.0</td>
<td>52.0</td>
<td>52.0</td>
<td>52.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>5</td>
<td>2023-02-01</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>79.0</td>
<td>79.0</td>
<td>79.0</td>
<td>79.0</td>
<td>77.0</td>
<td>77.0</td>
<td>77.0</td>
<td>77.0</td>
<td>79.0</td>
<td>79.0</td>
<td>79.0</td>
<td>79.0</td>
<td>77.0</td>
<td>77.0</td>
<td>77.0</td>
<td>77.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>6</td>
<td>2023-02-01</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>7</td>
<td>2023-02-01</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>-44.0</td>
<td>-44.0</td>
<td>-44.0</td>
<td>-44.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>-44.0</td>
<td>-44.0</td>
<td>-44.0</td>
<td>-44.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>10</td>
<td>2023-02-01</td>
<td>11.0</td>
<td>11.0</td>
<td>11.0</td>
<td>11.0</td>
<td>-39.0</td>
<td>-39.0</td>
<td>-39.0</td>
<td>-39.0</td>
<td>11.0</td>
<td>11.0</td>
<td>11.0</td>
<td>11.0</td>
<td>-39.0</td>
<td>-39.0</td>
<td>-39.0</td>
<td>-39.0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p><span style="color: blue;">(EN)</span> Here’s an example of saving a file with the created query and directly creating the table in the database:</p>
<p><span style="color: green;">(PT)</span> Segue um exemplo para salvar um arquivo com a query criada e criar a tabela diretamente no banco de dados:</p>
<div id="cell-44" class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>tb_publico <span class="op">=</span> <span class="st">'tb_spine'</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>list_window <span class="op">=</span> [<span class="dv">3</span>, <span class="dv">6</span>]</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>lista_feat_num <span class="op">=</span> [<span class="st">'FEAT_NUM1'</span>, <span class="st">'FEAT_NUM2'</span>]</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>feat_cat <span class="op">=</span> <span class="st">'FEAT_CAT1'</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>list_aggregator_value <span class="op">=</span> [<span class="st">'A'</span>, <span class="st">'B'</span>]</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="bu">id</span> <span class="op">=</span> <span class="st">'ID'</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>safra_ref <span class="op">=</span> <span class="st">'SAFRA_REF'</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>tb_feat <span class="op">=</span> <span class="st">'tb_feat'</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>safra <span class="op">=</span> <span class="st">'SAFRA'</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>status <span class="op">=</span> <span class="va">True</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>file_name <span class="op">=</span> <span class="st">'nome_da_tabela_criada'</span></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>file_name <span class="op">=</span> <span class="st">'table.sql'</span></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>query <span class="op">=</span> sqlite_create_query_agregada(tb_publico, tb_feat, list_window, lista_feat_num, <span class="bu">id</span>, safra_ref, safra, feat_cat, list_aggregator_value, file_name<span class="op">=</span>file_name, status<span class="op">=</span>status, table_name<span class="op">=</span>table_name, conn<span class="op">=</span>conn)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Complete query creation with table.sql saved file</code></pre>
</div>
</div>
<p><span style="color: blue;">(EN)</span> To verify the creation, let’s check the database table using the name of the created table:</p>
<p><span style="color: green;">(PT)</span> Para conferir a criação, vamos consultar o banco de dados com o nome da tabela que foi criada:</p>
<div id="cell-46" class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>query<span class="op">=</span><span class="ss">f"""SELECT  * from </span><span class="sc">{</span>table_name<span class="sc">}</span><span class="ss">"""</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_sql(query, conn)</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ID</th>
<th data-quarto-table-cell-role="th">SAFRA_REF</th>
<th data-quarto-table-cell-role="th">SUM_FEAT_NUM1_FEAT_CAT1_A_3M</th>
<th data-quarto-table-cell-role="th">MAX_FEAT_NUM1_FEAT_CAT1_A_3M</th>
<th data-quarto-table-cell-role="th">MIN_FEAT_NUM1_FEAT_CAT1_A_3M</th>
<th data-quarto-table-cell-role="th">AVG_FEAT_NUM1_FEAT_CAT1_A_3M</th>
<th data-quarto-table-cell-role="th">SUM_FEAT_NUM2_FEAT_CAT1_A_3M</th>
<th data-quarto-table-cell-role="th">MAX_FEAT_NUM2_FEAT_CAT1_A_3M</th>
<th data-quarto-table-cell-role="th">MIN_FEAT_NUM2_FEAT_CAT1_A_3M</th>
<th data-quarto-table-cell-role="th">AVG_FEAT_NUM2_FEAT_CAT1_A_3M</th>
<th data-quarto-table-cell-role="th">SUM_FEAT_NUM1_FEAT_CAT1_A_6M</th>
<th data-quarto-table-cell-role="th">MAX_FEAT_NUM1_FEAT_CAT1_A_6M</th>
<th data-quarto-table-cell-role="th">MIN_FEAT_NUM1_FEAT_CAT1_A_6M</th>
<th data-quarto-table-cell-role="th">AVG_FEAT_NUM1_FEAT_CAT1_A_6M</th>
<th data-quarto-table-cell-role="th">SUM_FEAT_NUM2_FEAT_CAT1_A_6M</th>
<th data-quarto-table-cell-role="th">MAX_FEAT_NUM2_FEAT_CAT1_A_6M</th>
<th data-quarto-table-cell-role="th">MIN_FEAT_NUM2_FEAT_CAT1_A_6M</th>
<th data-quarto-table-cell-role="th">AVG_FEAT_NUM2_FEAT_CAT1_A_6M</th>
<th data-quarto-table-cell-role="th">SUM_FEAT_NUM1_FEAT_CAT1_B_3M</th>
<th data-quarto-table-cell-role="th">MAX_FEAT_NUM1_FEAT_CAT1_B_3M</th>
<th data-quarto-table-cell-role="th">MIN_FEAT_NUM1_FEAT_CAT1_B_3M</th>
<th data-quarto-table-cell-role="th">AVG_FEAT_NUM1_FEAT_CAT1_B_3M</th>
<th data-quarto-table-cell-role="th">SUM_FEAT_NUM2_FEAT_CAT1_B_3M</th>
<th data-quarto-table-cell-role="th">MAX_FEAT_NUM2_FEAT_CAT1_B_3M</th>
<th data-quarto-table-cell-role="th">MIN_FEAT_NUM2_FEAT_CAT1_B_3M</th>
<th data-quarto-table-cell-role="th">AVG_FEAT_NUM2_FEAT_CAT1_B_3M</th>
<th data-quarto-table-cell-role="th">SUM_FEAT_NUM1_FEAT_CAT1_B_6M</th>
<th data-quarto-table-cell-role="th">MAX_FEAT_NUM1_FEAT_CAT1_B_6M</th>
<th data-quarto-table-cell-role="th">MIN_FEAT_NUM1_FEAT_CAT1_B_6M</th>
<th data-quarto-table-cell-role="th">AVG_FEAT_NUM1_FEAT_CAT1_B_6M</th>
<th data-quarto-table-cell-role="th">SUM_FEAT_NUM2_FEAT_CAT1_B_6M</th>
<th data-quarto-table-cell-role="th">MAX_FEAT_NUM2_FEAT_CAT1_B_6M</th>
<th data-quarto-table-cell-role="th">MIN_FEAT_NUM2_FEAT_CAT1_B_6M</th>
<th data-quarto-table-cell-role="th">AVG_FEAT_NUM2_FEAT_CAT1_B_6M</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>4</td>
<td>2023-02-01</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>74.0</td>
<td>74.0</td>
<td>74.0</td>
<td>74.0</td>
<td>52.0</td>
<td>52.0</td>
<td>52.0</td>
<td>52.0</td>
<td>74.0</td>
<td>74.0</td>
<td>74.0</td>
<td>74.0</td>
<td>52.0</td>
<td>52.0</td>
<td>52.0</td>
<td>52.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>5</td>
<td>2023-02-01</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>79.0</td>
<td>79.0</td>
<td>79.0</td>
<td>79.0</td>
<td>77.0</td>
<td>77.0</td>
<td>77.0</td>
<td>77.0</td>
<td>79.0</td>
<td>79.0</td>
<td>79.0</td>
<td>79.0</td>
<td>77.0</td>
<td>77.0</td>
<td>77.0</td>
<td>77.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>6</td>
<td>2023-02-01</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>7</td>
<td>2023-02-01</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>-44.0</td>
<td>-44.0</td>
<td>-44.0</td>
<td>-44.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>-44.0</td>
<td>-44.0</td>
<td>-44.0</td>
<td>-44.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>10</td>
<td>2023-02-01</td>
<td>11.0</td>
<td>11.0</td>
<td>11.0</td>
<td>11.0</td>
<td>-39.0</td>
<td>-39.0</td>
<td>-39.0</td>
<td>-39.0</td>
<td>11.0</td>
<td>11.0</td>
<td>11.0</td>
<td>11.0</td>
<td>-39.0</td>
<td>-39.0</td>
<td>-39.0</td>
<td>-39.0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
</section>
<section id="mysql" class="level2">
<h2 class="anchored" data-anchor-id="mysql">2. MySQL</h2>
<section id="setting-up-the-connection-configurando-a-conexão" class="level3">
<h3 class="anchored" data-anchor-id="setting-up-the-connection-configurando-a-conexão">Setting up the connection (Configurando a conexão)</h3>
<div id="cell-49" class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>host <span class="op">=</span> <span class="st">"localhost"</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>user <span class="op">=</span> <span class="st">"sqluser"</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>password <span class="op">=</span> <span class="st">"password"</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>database <span class="op">=</span> <span class="st">"mydatabase"</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Conectar ao MySQL</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>connection <span class="op">=</span> mysql.connector.<span class="ex">connect</span>(</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>    host<span class="op">=</span>host,</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>    user<span class="op">=</span>user,</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>    password<span class="op">=</span>password,</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>    database<span class="op">=</span>database</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="initial-view-of-the-public-visão-inicial-do-público-1" class="level3">
<h3 class="anchored" data-anchor-id="initial-view-of-the-public-visão-inicial-do-público-1">Initial view of the public (Visão inicial do público)</h3>
<p><span style="color: blue;">(EN)</span> First, let’s observe the format of the spine table.</p>
<p><span style="color: green;">(PT)</span> Primeiro vamos observar o formato da tabela spine</p>
<div id="cell-52" class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>df_spine <span class="op">=</span> pd.read_sql(<span class="st">"SELECT * FROM tb_spine"</span>, connection)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>df_spine.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/tmp/ipykernel_31659/1385309256.py:3: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df_spine = pd.read_sql("SELECT * FROM tb_spine", connection)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ID</th>
<th data-quarto-table-cell-role="th">SAFRA_REF</th>
<th data-quarto-table-cell-role="th">Target</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>4</td>
<td>2023-02-01</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>5</td>
<td>2023-02-01</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>6</td>
<td>2023-02-01</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>7</td>
<td>2023-02-01</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>10</td>
<td>2023-02-01</td>
<td>0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="initial-view-of-the-variables-table-visão-inicial-da-tabela-de-variáveis-1" class="level3">
<h3 class="anchored" data-anchor-id="initial-view-of-the-variables-table-visão-inicial-da-tabela-de-variáveis-1">Initial view of the variables table (Visão inicial da tabela de variáveis)</h3>
<p><span style="color: blue;">(EN)</span> The table tb_feat contains 4 variables, two numeric and two categorical. Note that there are more unique IDs and dates available in this than in the spine table, as is often the case.</p>
<p><span style="color: green;">(PT)</span> A tabela tb_feat contém 4 variáveis, duas sendo numéricas e duas categórica. Perceba que existem mais ID’s únicos e datas disponíveis nessa tabela do que na tabela spine, caso que ocorre no dia a dia.</p>
<div id="cell-55" class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>df_data <span class="op">=</span> pd.read_sql(<span class="st">"SELECT * FROM tb_feat"</span>, connection)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>df_data.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/tmp/ipykernel_31659/548342132.py:3: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df_data = pd.read_sql("SELECT * FROM tb_feat", connection)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ID</th>
<th data-quarto-table-cell-role="th">SAFRA</th>
<th data-quarto-table-cell-role="th">FEAT_NUM1</th>
<th data-quarto-table-cell-role="th">FEAT_NUM2</th>
<th data-quarto-table-cell-role="th">FEAT_CAT1</th>
<th data-quarto-table-cell-role="th">FEAT_CAT2</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1</td>
<td>2023-01-01</td>
<td>73</td>
<td>23</td>
<td>B</td>
<td>B</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>3</td>
<td>2023-01-01</td>
<td>15</td>
<td>1</td>
<td>B</td>
<td>B</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>5</td>
<td>2023-01-01</td>
<td>75</td>
<td>71</td>
<td>A</td>
<td>A</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>7</td>
<td>2023-01-01</td>
<td>73</td>
<td>82</td>
<td>B</td>
<td>C</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>9</td>
<td>2023-01-01</td>
<td>61</td>
<td>8</td>
<td>C</td>
<td>B</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="creation-of-numerical-variables-criação-de-variáveis-numéricas-1" class="level3">
<h3 class="anchored" data-anchor-id="creation-of-numerical-variables-criação-de-variáveis-numéricas-1">Creation of numerical variables (Criação de variáveis numéricas)</h3>
<p><span style="color: blue;">(EN)</span> The function <code>mysql_create_query_num()</code> creates a query text for generating variables with the sum, minimum, maximum, and average operations on the variables listed in feat_num_lista and within the time window listed in list_window.</p>
<p><span style="color: green;">(PT)</span> A função <code>mysql_create_query_num()</code> cria um texto com a query para a criação de variáveis com as operações soma, mínimo, máximo e média das variáveis listadas em feat_num_lista e com a janela de tempo listada em list_window.</p>
<div id="cell-58" class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>tb_publico <span class="op">=</span> <span class="st">'tb_spine'</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>tb_feat <span class="op">=</span> <span class="st">'tb_feat'</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="bu">id</span> <span class="op">=</span> <span class="st">'ID'</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>safra_ref <span class="op">=</span> <span class="st">'SAFRA_REF'</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>safra <span class="op">=</span> <span class="st">'SAFRA'</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>feat_num_lista <span class="op">=</span> [<span class="st">'FEAT_NUM1'</span>,<span class="st">'FEAT_NUM2'</span>]</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>list_window <span class="op">=</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>]</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>query_final_num_mysql <span class="op">=</span> mysql_create_query_num(tb_publico, tb_feat, list_window,feat_num_lista, <span class="bu">id</span>, safra_ref, safra)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Complete query creation with no saved file.</code></pre>
</div>
</div>
<div id="cell-59" class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>df_num_mysql <span class="op">=</span> pd.read_sql(query_final_num_mysql, connection)</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>df_num_mysql.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/tmp/ipykernel_31659/3114881597.py:3: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df_num_mysql = pd.read_sql(query_final_num_mysql, connection)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ID</th>
<th data-quarto-table-cell-role="th">SAFRA_REF</th>
<th data-quarto-table-cell-role="th">FEAT_NUM1_SUM_1M</th>
<th data-quarto-table-cell-role="th">FEAT_NUM1_MIN_1M</th>
<th data-quarto-table-cell-role="th">FEAT_NUM1_MAX_1M</th>
<th data-quarto-table-cell-role="th">FEAT_NUM1_AVG_1M</th>
<th data-quarto-table-cell-role="th">FEAT_NUM2_SUM_1M</th>
<th data-quarto-table-cell-role="th">FEAT_NUM2_MIN_1M</th>
<th data-quarto-table-cell-role="th">FEAT_NUM2_MAX_1M</th>
<th data-quarto-table-cell-role="th">FEAT_NUM2_AVG_1M</th>
<th data-quarto-table-cell-role="th">FEAT_NUM1_SUM_2M</th>
<th data-quarto-table-cell-role="th">FEAT_NUM1_MIN_2M</th>
<th data-quarto-table-cell-role="th">FEAT_NUM1_MAX_2M</th>
<th data-quarto-table-cell-role="th">FEAT_NUM1_AVG_2M</th>
<th data-quarto-table-cell-role="th">FEAT_NUM2_SUM_2M</th>
<th data-quarto-table-cell-role="th">FEAT_NUM2_MIN_2M</th>
<th data-quarto-table-cell-role="th">FEAT_NUM2_MAX_2M</th>
<th data-quarto-table-cell-role="th">FEAT_NUM2_AVG_2M</th>
<th data-quarto-table-cell-role="th">FEAT_NUM1_SUM_3M</th>
<th data-quarto-table-cell-role="th">FEAT_NUM1_MIN_3M</th>
<th data-quarto-table-cell-role="th">FEAT_NUM1_MAX_3M</th>
<th data-quarto-table-cell-role="th">FEAT_NUM1_AVG_3M</th>
<th data-quarto-table-cell-role="th">FEAT_NUM2_SUM_3M</th>
<th data-quarto-table-cell-role="th">FEAT_NUM2_MIN_3M</th>
<th data-quarto-table-cell-role="th">FEAT_NUM2_MAX_3M</th>
<th data-quarto-table-cell-role="th">FEAT_NUM2_AVG_3M</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>4</td>
<td>2023-02-01</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>5</td>
<td>2023-02-01</td>
<td>75.0</td>
<td>75.0</td>
<td>75.0</td>
<td>75.0</td>
<td>71.0</td>
<td>71.0</td>
<td>71.0</td>
<td>71.0</td>
<td>75.0</td>
<td>75.0</td>
<td>75.0</td>
<td>75.0</td>
<td>71.0</td>
<td>71.0</td>
<td>71.0</td>
<td>71.0</td>
<td>75.0</td>
<td>75.0</td>
<td>75.0</td>
<td>75.0</td>
<td>71.0</td>
<td>71.0</td>
<td>71.0</td>
<td>71.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>6</td>
<td>2023-02-01</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>7</td>
<td>2023-02-01</td>
<td>73.0</td>
<td>73.0</td>
<td>73.0</td>
<td>73.0</td>
<td>82.0</td>
<td>82.0</td>
<td>82.0</td>
<td>82.0</td>
<td>73.0</td>
<td>73.0</td>
<td>73.0</td>
<td>73.0</td>
<td>82.0</td>
<td>82.0</td>
<td>82.0</td>
<td>82.0</td>
<td>73.0</td>
<td>73.0</td>
<td>73.0</td>
<td>73.0</td>
<td>82.0</td>
<td>82.0</td>
<td>82.0</td>
<td>82.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>10</td>
<td>2023-02-01</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p><span style="color: blue;">(EN)</span> We can use the <code>file_name</code> parameter with a name in the format ‘table.sql’ to save the creation query in a file in the same folder where it is executed.</p>
<p><span style="color: green;">(PT)</span> Podemos utilizar o parâmetro <code>file_name</code> com um nome no formato “table.sql” para salvar query de criação em um arquivo na mesma pasta que é executado.</p>
<div id="cell-61" class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>tb_publico <span class="op">=</span> <span class="st">'tb_spine'</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>tb_feat <span class="op">=</span> <span class="st">'tb_feat'</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="bu">id</span> <span class="op">=</span> <span class="st">'ID'</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>safra_ref <span class="op">=</span> <span class="st">'SAFRA_REF'</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>safra <span class="op">=</span> <span class="st">'SAFRA'</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>feat_num_lista <span class="op">=</span> [<span class="st">'FEAT_NUM1'</span>,<span class="st">'FEAT_NUM2'</span>]</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>list_window <span class="op">=</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>]</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>status <span class="op">=</span> <span class="va">True</span></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>table_name <span class="op">=</span> <span class="st">'nome_da_tabela_criada'</span></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>file_name <span class="op">=</span> <span class="st">'table.sql'</span></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>query_final_num_mysql <span class="op">=</span> mysql_create_query_num(tb_publico, tb_feat, list_window, feat_num_lista, <span class="bu">id</span>, safra_ref, safra, file_name<span class="op">=</span>file_name, status<span class="op">=</span>status, table_name<span class="op">=</span>table_name, conn<span class="op">=</span>connection)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>ProgrammingError: 1064 (42000): You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ']
-- Create table with the name nome_da_tabela_criada
-- Criar a tabela nome_da_' at line 1</code></pre>
</div>
</div>
<p><span style="color: blue;">(EN)</span> To verify the creation, let’s check the database table using the name of the created table:</p>
<p><span style="color: green;">(PT)</span> Para conferir a criação, vamos consultar o banco de dados com o nome da tabela que foi criada:</p>
<div id="cell-63" class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>query<span class="op">=</span><span class="ss">f"""SELECT  * from </span><span class="sc">{</span>table_name<span class="sc">}</span><span class="ss">"""</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_sql(query, connection)</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/tmp/ipykernel_1661/3805114983.py:4: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, connection)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ID</th>
<th data-quarto-table-cell-role="th">SAFRA_REF</th>
<th data-quarto-table-cell-role="th">FEAT_NUM1_SUM_1M</th>
<th data-quarto-table-cell-role="th">FEAT_NUM1_MIN_1M</th>
<th data-quarto-table-cell-role="th">FEAT_NUM1_MAX_1M</th>
<th data-quarto-table-cell-role="th">FEAT_NUM1_AVG_1M</th>
<th data-quarto-table-cell-role="th">FEAT_NUM2_SUM_1M</th>
<th data-quarto-table-cell-role="th">FEAT_NUM2_MIN_1M</th>
<th data-quarto-table-cell-role="th">FEAT_NUM2_MAX_1M</th>
<th data-quarto-table-cell-role="th">FEAT_NUM2_AVG_1M</th>
<th data-quarto-table-cell-role="th">FEAT_NUM1_SUM_2M</th>
<th data-quarto-table-cell-role="th">FEAT_NUM1_MIN_2M</th>
<th data-quarto-table-cell-role="th">FEAT_NUM1_MAX_2M</th>
<th data-quarto-table-cell-role="th">FEAT_NUM1_AVG_2M</th>
<th data-quarto-table-cell-role="th">FEAT_NUM2_SUM_2M</th>
<th data-quarto-table-cell-role="th">FEAT_NUM2_MIN_2M</th>
<th data-quarto-table-cell-role="th">FEAT_NUM2_MAX_2M</th>
<th data-quarto-table-cell-role="th">FEAT_NUM2_AVG_2M</th>
<th data-quarto-table-cell-role="th">FEAT_NUM1_SUM_3M</th>
<th data-quarto-table-cell-role="th">FEAT_NUM1_MIN_3M</th>
<th data-quarto-table-cell-role="th">FEAT_NUM1_MAX_3M</th>
<th data-quarto-table-cell-role="th">FEAT_NUM1_AVG_3M</th>
<th data-quarto-table-cell-role="th">FEAT_NUM2_SUM_3M</th>
<th data-quarto-table-cell-role="th">FEAT_NUM2_MIN_3M</th>
<th data-quarto-table-cell-role="th">FEAT_NUM2_MAX_3M</th>
<th data-quarto-table-cell-role="th">FEAT_NUM2_AVG_3M</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>4</td>
<td>2023-02-01</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>5</td>
<td>2023-02-01</td>
<td>75.0</td>
<td>75.0</td>
<td>75.0</td>
<td>75.0</td>
<td>71.0</td>
<td>71.0</td>
<td>71.0</td>
<td>71.0</td>
<td>75.0</td>
<td>75.0</td>
<td>75.0</td>
<td>75.0</td>
<td>71.0</td>
<td>71.0</td>
<td>71.0</td>
<td>71.0</td>
<td>75.0</td>
<td>75.0</td>
<td>75.0</td>
<td>75.0</td>
<td>71.0</td>
<td>71.0</td>
<td>71.0</td>
<td>71.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>6</td>
<td>2023-02-01</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>7</td>
<td>2023-02-01</td>
<td>73.0</td>
<td>73.0</td>
<td>73.0</td>
<td>73.0</td>
<td>82.0</td>
<td>82.0</td>
<td>82.0</td>
<td>82.0</td>
<td>73.0</td>
<td>73.0</td>
<td>73.0</td>
<td>73.0</td>
<td>82.0</td>
<td>82.0</td>
<td>82.0</td>
<td>82.0</td>
<td>73.0</td>
<td>73.0</td>
<td>73.0</td>
<td>73.0</td>
<td>82.0</td>
<td>82.0</td>
<td>82.0</td>
<td>82.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>10</td>
<td>2023-02-01</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="creation-of-categorical-variables-criação-de-variáveis-categóricas-1" class="level3">
<h3 class="anchored" data-anchor-id="creation-of-categorical-variables-criação-de-variáveis-categóricas-1">Creation of categorical variables (Criação de variáveis categóricas)</h3>
<p><span style="color: blue;">(EN)</span> The function <code>mysql_create_query_cat()</code> generates a query text for creating variables with the mode of each variable listed in feat_num_lista within the time window provided in list_window.</p>
<p><span style="color: green;">(PT)</span> A função <code>mysql_create_query_cat()</code> cria um texto com a query para a criação de variáveis com a moda de cada uma das variáveis listadas em feat_num_lista na janela de tempo fornecida em list_window.</p>
<div id="cell-66" class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>tb_publico <span class="op">=</span> <span class="st">'tb_spine'</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>tb_feat <span class="op">=</span> <span class="st">'tb_feat'</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="bu">id</span> <span class="op">=</span> <span class="st">'ID'</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>safra_ref <span class="op">=</span> <span class="st">'SAFRA_REF'</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>safra <span class="op">=</span> <span class="st">'SAFRA'</span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>feat_num_lista <span class="op">=</span> [<span class="st">'FEAT_CAT1'</span>,<span class="st">'FEAT_CAT2'</span>]</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>list_window <span class="op">=</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>]</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>query_final_cat_mysql <span class="op">=</span> mysql_create_query_cat(tb_publico, tb_feat, list_window, feat_num_lista, <span class="bu">id</span>, safra_ref, safra)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Complete query creation with no saved file.</code></pre>
</div>
</div>
<div id="cell-67" class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>df_cat_sqlite_mysql <span class="op">=</span> pd.read_sql(query_final_cat_mysql, connection)</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>df_cat_sqlite_mysql.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/tmp/ipykernel_1661/827211967.py:3: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df_cat_sqlite_mysql = pd.read_sql(query_final_cat_mysql, connection)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ID</th>
<th data-quarto-table-cell-role="th">SAFRA_REF</th>
<th data-quarto-table-cell-role="th">FEAT_CAT1_MODA_1M</th>
<th data-quarto-table-cell-role="th">FEAT_CAT2_MODA_1M</th>
<th data-quarto-table-cell-role="th">FEAT_CAT1_MODA_2M</th>
<th data-quarto-table-cell-role="th">FEAT_CAT2_MODA_2M</th>
<th data-quarto-table-cell-role="th">FEAT_CAT1_MODA_3M</th>
<th data-quarto-table-cell-role="th">FEAT_CAT2_MODA_3M</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>4</td>
<td>2023-02-01</td>
<td>None</td>
<td>None</td>
<td>None</td>
<td>None</td>
<td>None</td>
<td>None</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>5</td>
<td>2023-02-01</td>
<td>A</td>
<td>A</td>
<td>A</td>
<td>A</td>
<td>A</td>
<td>A</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>6</td>
<td>2023-02-01</td>
<td>None</td>
<td>None</td>
<td>None</td>
<td>None</td>
<td>None</td>
<td>None</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>7</td>
<td>2023-02-01</td>
<td>B</td>
<td>C</td>
<td>B</td>
<td>C</td>
<td>B</td>
<td>C</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>10</td>
<td>2023-02-01</td>
<td>None</td>
<td>None</td>
<td>None</td>
<td>None</td>
<td>None</td>
<td>None</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p><span style="color: blue;">(EN)</span> The function <code>sqlite_create_query_cat()</code> also allows saving a file with the created query and creating the table directly in the database. Here’s an example:</p>
<p><span style="color: green;">(PT)</span> A função <code>sqlite_create_query_cat()</code> também permite salvar um arquivo com a query criada e criar a tabela diretamente no banco de dados. Segue um exemplo:</p>
<div id="cell-69" class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>tb_publico <span class="op">=</span> <span class="st">'tb_spine'</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>tb_feat <span class="op">=</span> <span class="st">'tb_feat'</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="bu">id</span> <span class="op">=</span> <span class="st">'ID'</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>safra_ref <span class="op">=</span> <span class="st">'SAFRA_REF'</span></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>safra <span class="op">=</span> <span class="st">'SAFRA'</span></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>feat_num_lista <span class="op">=</span> [<span class="st">'FEAT_CAT1'</span>, <span class="st">'FEAT_CAT2'</span>]</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>list_window <span class="op">=</span> [<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">6</span>]</span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>status <span class="op">=</span> <span class="va">True</span></span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>table_name <span class="op">=</span> <span class="st">'nome_da_tabela_criada'</span></span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a>file_name <span class="op">=</span> <span class="st">'table.sql'</span></span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a>query_final_cat_mysql <span class="op">=</span> mysql_create_query_cat(tb_publico, tb_feat, list_window,feat_num_lista, <span class="bu">id</span>, safra_ref, safra, file_name<span class="op">=</span>file_name, status<span class="op">=</span>status, table_name<span class="op">=</span>table_name, conn<span class="op">=</span>connection)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Complete query creation with table.sql saved file</code></pre>
</div>
</div>
<p><span style="color: blue;">(EN)</span> To verify the creation, let’s check the database table using the name of the created table:</p>
<p><span style="color: green;">(PT)</span> Para conferir a criação, vamos consultar o banco de dados com o nome da tabela que foi criada:</p>
<div id="cell-71" class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>query<span class="op">=</span><span class="ss">f"""SELECT  * from </span><span class="sc">{</span>table_name<span class="sc">}</span><span class="ss">"""</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_sql(query, connection)</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/tmp/ipykernel_1661/3805114983.py:4: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, connection)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ID</th>
<th data-quarto-table-cell-role="th">SAFRA_REF</th>
<th data-quarto-table-cell-role="th">FEAT_CAT1_MODA_1M</th>
<th data-quarto-table-cell-role="th">FEAT_CAT2_MODA_1M</th>
<th data-quarto-table-cell-role="th">FEAT_CAT1_MODA_3M</th>
<th data-quarto-table-cell-role="th">FEAT_CAT2_MODA_3M</th>
<th data-quarto-table-cell-role="th">FEAT_CAT1_MODA_6M</th>
<th data-quarto-table-cell-role="th">FEAT_CAT2_MODA_6M</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>4</td>
<td>2023-02-01</td>
<td>None</td>
<td>None</td>
<td>None</td>
<td>None</td>
<td>None</td>
<td>None</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>5</td>
<td>2023-02-01</td>
<td>A</td>
<td>A</td>
<td>A</td>
<td>A</td>
<td>A</td>
<td>A</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>6</td>
<td>2023-02-01</td>
<td>None</td>
<td>None</td>
<td>None</td>
<td>None</td>
<td>None</td>
<td>None</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>7</td>
<td>2023-02-01</td>
<td>B</td>
<td>C</td>
<td>B</td>
<td>C</td>
<td>B</td>
<td>C</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>10</td>
<td>2023-02-01</td>
<td>None</td>
<td>None</td>
<td>None</td>
<td>None</td>
<td>None</td>
<td>None</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="creation-of-aggregated-variables-criação-de-variáveis-agregadas-1" class="level3">
<h3 class="anchored" data-anchor-id="creation-of-aggregated-variables-criação-de-variáveis-agregadas-1">Creation of aggregated variables (Criação de variáveis agregadas)</h3>
<p><span style="color: blue;">(EN)</span> We can create features by aggregating on a specific value of a categorical variable and calculating sum, avg, min, and max operations for user-defined numerical variables. For example, for the variable FEAT_CAT1 having a value of A or B, we calculate sum, avg, min, and max operations for the variables FEAT_NUM1 and FEAT_NUM2. Here’s a use case:</p>
<p><span style="color: green;">(PT)</span> Podemos criar variáveis agregando por valor específico de variável categórica e calculando as operações de sum, avg, min e max para as variáveis númericas definidas pelo usuário. Por exemplo, para a variável <code>FEAT_CAT1</code> tendo valor igual a <code>A</code> ou <code>B</code>, calculamos as operações de sum, avg, min e max para as variáveis <code>FEAT_NUM1</code> e <code>FEAT_NUM2</code>. Segue um caso de uso:</p>
<div id="cell-74" class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>tb_publico <span class="op">=</span> <span class="st">'tb_spine'</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>list_window <span class="op">=</span> [<span class="dv">3</span>, <span class="dv">6</span>]</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>lista_feat_num <span class="op">=</span> [<span class="st">'FEAT_NUM1'</span>, <span class="st">'FEAT_NUM2'</span>]</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>feat_cat <span class="op">=</span> <span class="st">'FEAT_CAT1'</span></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>lista_valor_agragador <span class="op">=</span> [<span class="st">'A'</span>, <span class="st">'B'</span>]</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a><span class="bu">id</span> <span class="op">=</span> <span class="st">'ID'</span></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>safra_ref <span class="op">=</span> <span class="st">'SAFRA_REF'</span></span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>tb_feat <span class="op">=</span> <span class="st">'tb_feat'</span></span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>safra <span class="op">=</span> <span class="st">'SAFRA'</span></span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>query <span class="op">=</span> mysql_create_query_agregada(tb_publico, tb_feat, list_window, lista_feat_num, <span class="bu">id</span>, safra_ref, safra, feat_cat, lista_valor_agragador)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Complete query creation with no saved file.</code></pre>
</div>
</div>
<div id="cell-75" class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>df_mysql_agregada <span class="op">=</span> pd.read_sql(query, connection)</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>df_mysql_agregada.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/tmp/ipykernel_1661/789764728.py:3: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df_mysql_agregada = pd.read_sql(query, connection)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ID</th>
<th data-quarto-table-cell-role="th">SAFRA_REF</th>
<th data-quarto-table-cell-role="th">SUM_FEAT_NUM1_FEAT_CAT1_A_3M</th>
<th data-quarto-table-cell-role="th">MAX_FEAT_NUM1_FEAT_CAT1_A_3M</th>
<th data-quarto-table-cell-role="th">MIN_FEAT_NUM1_FEAT_CAT1_A_3M</th>
<th data-quarto-table-cell-role="th">AVG_FEAT_NUM1_FEAT_CAT1_A_3M</th>
<th data-quarto-table-cell-role="th">SUM_FEAT_NUM2_FEAT_CAT1_A_3M</th>
<th data-quarto-table-cell-role="th">MAX_FEAT_NUM2_FEAT_CAT1_A_3M</th>
<th data-quarto-table-cell-role="th">MIN_FEAT_NUM2_FEAT_CAT1_A_3M</th>
<th data-quarto-table-cell-role="th">AVG_FEAT_NUM2_FEAT_CAT1_A_3M</th>
<th data-quarto-table-cell-role="th">SUM_FEAT_NUM1_FEAT_CAT1_A_6M</th>
<th data-quarto-table-cell-role="th">MAX_FEAT_NUM1_FEAT_CAT1_A_6M</th>
<th data-quarto-table-cell-role="th">MIN_FEAT_NUM1_FEAT_CAT1_A_6M</th>
<th data-quarto-table-cell-role="th">AVG_FEAT_NUM1_FEAT_CAT1_A_6M</th>
<th data-quarto-table-cell-role="th">SUM_FEAT_NUM2_FEAT_CAT1_A_6M</th>
<th data-quarto-table-cell-role="th">MAX_FEAT_NUM2_FEAT_CAT1_A_6M</th>
<th data-quarto-table-cell-role="th">MIN_FEAT_NUM2_FEAT_CAT1_A_6M</th>
<th data-quarto-table-cell-role="th">AVG_FEAT_NUM2_FEAT_CAT1_A_6M</th>
<th data-quarto-table-cell-role="th">SUM_FEAT_NUM1_FEAT_CAT1_B_3M</th>
<th data-quarto-table-cell-role="th">MAX_FEAT_NUM1_FEAT_CAT1_B_3M</th>
<th data-quarto-table-cell-role="th">MIN_FEAT_NUM1_FEAT_CAT1_B_3M</th>
<th data-quarto-table-cell-role="th">AVG_FEAT_NUM1_FEAT_CAT1_B_3M</th>
<th data-quarto-table-cell-role="th">SUM_FEAT_NUM2_FEAT_CAT1_B_3M</th>
<th data-quarto-table-cell-role="th">MAX_FEAT_NUM2_FEAT_CAT1_B_3M</th>
<th data-quarto-table-cell-role="th">MIN_FEAT_NUM2_FEAT_CAT1_B_3M</th>
<th data-quarto-table-cell-role="th">AVG_FEAT_NUM2_FEAT_CAT1_B_3M</th>
<th data-quarto-table-cell-role="th">SUM_FEAT_NUM1_FEAT_CAT1_B_6M</th>
<th data-quarto-table-cell-role="th">MAX_FEAT_NUM1_FEAT_CAT1_B_6M</th>
<th data-quarto-table-cell-role="th">MIN_FEAT_NUM1_FEAT_CAT1_B_6M</th>
<th data-quarto-table-cell-role="th">AVG_FEAT_NUM1_FEAT_CAT1_B_6M</th>
<th data-quarto-table-cell-role="th">SUM_FEAT_NUM2_FEAT_CAT1_B_6M</th>
<th data-quarto-table-cell-role="th">MAX_FEAT_NUM2_FEAT_CAT1_B_6M</th>
<th data-quarto-table-cell-role="th">MIN_FEAT_NUM2_FEAT_CAT1_B_6M</th>
<th data-quarto-table-cell-role="th">AVG_FEAT_NUM2_FEAT_CAT1_B_6M</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>4</td>
<td>2023-02-01</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>5</td>
<td>2023-02-01</td>
<td>75.0</td>
<td>75.0</td>
<td>75.0</td>
<td>75.0</td>
<td>71.0</td>
<td>71.0</td>
<td>71.0</td>
<td>71.0</td>
<td>75.0</td>
<td>75.0</td>
<td>75.0</td>
<td>75.0</td>
<td>71.0</td>
<td>71.0</td>
<td>71.0</td>
<td>71.0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>6</td>
<td>2023-02-01</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>7</td>
<td>2023-02-01</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>73.0</td>
<td>73.0</td>
<td>73.0</td>
<td>73.0</td>
<td>82.0</td>
<td>82.0</td>
<td>82.0</td>
<td>82.0</td>
<td>73.0</td>
<td>73.0</td>
<td>73.0</td>
<td>73.0</td>
<td>82.0</td>
<td>82.0</td>
<td>82.0</td>
<td>82.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>10</td>
<td>2023-02-01</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-76" class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>tb_publico <span class="op">=</span> <span class="st">'tb_spine'</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>list_window <span class="op">=</span> [<span class="dv">3</span>, <span class="dv">6</span>]</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>lista_feat_num <span class="op">=</span> [<span class="st">'FEAT_NUM1'</span>, <span class="st">'FEAT_NUM2'</span>]</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>feat_cat <span class="op">=</span> <span class="st">'FEAT_CAT2'</span></span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>lista_valor_agragador <span class="op">=</span> [<span class="st">'B'</span>, <span class="st">'C'</span>]</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a><span class="bu">id</span> <span class="op">=</span> <span class="st">'ID'</span></span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>safra_ref <span class="op">=</span> <span class="st">'SAFRA_REF'</span></span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>tb_feat <span class="op">=</span> <span class="st">'tb_feat'</span></span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a>safra <span class="op">=</span> <span class="st">'SAFRA'</span></span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a>query <span class="op">=</span> mysql_create_query_agregada(tb_publico, tb_feat, list_window, lista_feat_num, <span class="bu">id</span>, safra_ref, safra, feat_cat, lista_valor_agragador)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Complete query creation with no saved file.</code></pre>
</div>
</div>
<div id="cell-77" class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>df_mysql_agregada <span class="op">=</span> pd.read_sql(query, connection)</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>df_mysql_agregada.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/tmp/ipykernel_1661/789764728.py:3: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df_mysql_agregada = pd.read_sql(query, connection)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ID</th>
<th data-quarto-table-cell-role="th">SAFRA_REF</th>
<th data-quarto-table-cell-role="th">SUM_FEAT_NUM1_FEAT_CAT2_B_3M</th>
<th data-quarto-table-cell-role="th">MAX_FEAT_NUM1_FEAT_CAT2_B_3M</th>
<th data-quarto-table-cell-role="th">MIN_FEAT_NUM1_FEAT_CAT2_B_3M</th>
<th data-quarto-table-cell-role="th">AVG_FEAT_NUM1_FEAT_CAT2_B_3M</th>
<th data-quarto-table-cell-role="th">SUM_FEAT_NUM2_FEAT_CAT2_B_3M</th>
<th data-quarto-table-cell-role="th">MAX_FEAT_NUM2_FEAT_CAT2_B_3M</th>
<th data-quarto-table-cell-role="th">MIN_FEAT_NUM2_FEAT_CAT2_B_3M</th>
<th data-quarto-table-cell-role="th">AVG_FEAT_NUM2_FEAT_CAT2_B_3M</th>
<th data-quarto-table-cell-role="th">SUM_FEAT_NUM1_FEAT_CAT2_B_6M</th>
<th data-quarto-table-cell-role="th">MAX_FEAT_NUM1_FEAT_CAT2_B_6M</th>
<th data-quarto-table-cell-role="th">MIN_FEAT_NUM1_FEAT_CAT2_B_6M</th>
<th data-quarto-table-cell-role="th">AVG_FEAT_NUM1_FEAT_CAT2_B_6M</th>
<th data-quarto-table-cell-role="th">SUM_FEAT_NUM2_FEAT_CAT2_B_6M</th>
<th data-quarto-table-cell-role="th">MAX_FEAT_NUM2_FEAT_CAT2_B_6M</th>
<th data-quarto-table-cell-role="th">MIN_FEAT_NUM2_FEAT_CAT2_B_6M</th>
<th data-quarto-table-cell-role="th">AVG_FEAT_NUM2_FEAT_CAT2_B_6M</th>
<th data-quarto-table-cell-role="th">SUM_FEAT_NUM1_FEAT_CAT2_C_3M</th>
<th data-quarto-table-cell-role="th">MAX_FEAT_NUM1_FEAT_CAT2_C_3M</th>
<th data-quarto-table-cell-role="th">MIN_FEAT_NUM1_FEAT_CAT2_C_3M</th>
<th data-quarto-table-cell-role="th">AVG_FEAT_NUM1_FEAT_CAT2_C_3M</th>
<th data-quarto-table-cell-role="th">SUM_FEAT_NUM2_FEAT_CAT2_C_3M</th>
<th data-quarto-table-cell-role="th">MAX_FEAT_NUM2_FEAT_CAT2_C_3M</th>
<th data-quarto-table-cell-role="th">MIN_FEAT_NUM2_FEAT_CAT2_C_3M</th>
<th data-quarto-table-cell-role="th">AVG_FEAT_NUM2_FEAT_CAT2_C_3M</th>
<th data-quarto-table-cell-role="th">SUM_FEAT_NUM1_FEAT_CAT2_C_6M</th>
<th data-quarto-table-cell-role="th">MAX_FEAT_NUM1_FEAT_CAT2_C_6M</th>
<th data-quarto-table-cell-role="th">MIN_FEAT_NUM1_FEAT_CAT2_C_6M</th>
<th data-quarto-table-cell-role="th">AVG_FEAT_NUM1_FEAT_CAT2_C_6M</th>
<th data-quarto-table-cell-role="th">SUM_FEAT_NUM2_FEAT_CAT2_C_6M</th>
<th data-quarto-table-cell-role="th">MAX_FEAT_NUM2_FEAT_CAT2_C_6M</th>
<th data-quarto-table-cell-role="th">MIN_FEAT_NUM2_FEAT_CAT2_C_6M</th>
<th data-quarto-table-cell-role="th">AVG_FEAT_NUM2_FEAT_CAT2_C_6M</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>4</td>
<td>2023-02-01</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>5</td>
<td>2023-02-01</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>6</td>
<td>2023-02-01</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>7</td>
<td>2023-02-01</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>73.0</td>
<td>73.0</td>
<td>73.0</td>
<td>73.0</td>
<td>82.0</td>
<td>82.0</td>
<td>82.0</td>
<td>82.0</td>
<td>73.0</td>
<td>73.0</td>
<td>73.0</td>
<td>73.0</td>
<td>82.0</td>
<td>82.0</td>
<td>82.0</td>
<td>82.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>10</td>
<td>2023-02-01</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p><span style="color: blue;">(EN)</span> Here’s an example of saving a file with the created query and directly creating the table in the database:</p>
<p><span style="color: green;">(PT)</span> Segue um exemplo para salvar um arquivo com a query criada e criar a tabela diretamente no banco de dados:</p>
<div id="cell-79" class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>tb_publico <span class="op">=</span> <span class="st">'tb_spine'</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>list_window <span class="op">=</span> [<span class="dv">3</span>, <span class="dv">6</span>]</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>lista_feat_num <span class="op">=</span> [<span class="st">'FEAT_NUM1'</span>, <span class="st">'FEAT_NUM2'</span>]</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>feat_cat <span class="op">=</span> <span class="st">'FEAT_CAT1'</span></span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>lista_valor_agragador <span class="op">=</span> [<span class="st">'A'</span>, <span class="st">'B'</span>]</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a><span class="bu">id</span> <span class="op">=</span> <span class="st">'ID'</span></span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>safra_ref <span class="op">=</span> <span class="st">'SAFRA_REF'</span></span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a>tb_feat <span class="op">=</span> <span class="st">'tb_feat'</span></span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a>safra <span class="op">=</span> <span class="st">'SAFRA'</span></span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a>status <span class="op">=</span> <span class="va">True</span></span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a>table_name <span class="op">=</span> <span class="st">'nome_da_tabela_criada'</span></span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a>file_name <span class="op">=</span> <span class="st">'table.sql'</span></span>
<span id="cb59-13"><a href="#cb59-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-14"><a href="#cb59-14" aria-hidden="true" tabindex="-1"></a>query <span class="op">=</span> mysql_create_query_agregada(tb_publico, tb_feat, list_window, lista_feat_num, <span class="bu">id</span>, safra_ref, safra, feat_cat, lista_valor_agragador, file_name<span class="op">=</span>file_name, status<span class="op">=</span>status, table_name<span class="op">=</span>table_name, conn<span class="op">=</span>connection)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Complete query creation with table.sql saved file</code></pre>
</div>
</div>
<p><span style="color: blue;">(EN)</span> To verify the creation, let’s check the database table using the name of the created table:</p>
<p><span style="color: green;">(PT)</span> Para conferir a criação, vamos consultar o banco de dados com o nome da tabela que foi criada:</p>
<div id="cell-81" class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>query<span class="op">=</span><span class="ss">f"""SELECT  * from </span><span class="sc">{</span>table_name<span class="sc">}</span><span class="ss">"""</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_sql(query, connection)</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/tmp/ipykernel_1661/3805114983.py:4: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, connection)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ID</th>
<th data-quarto-table-cell-role="th">SAFRA_REF</th>
<th data-quarto-table-cell-role="th">SUM_FEAT_NUM1_FEAT_CAT1_A_3M</th>
<th data-quarto-table-cell-role="th">MAX_FEAT_NUM1_FEAT_CAT1_A_3M</th>
<th data-quarto-table-cell-role="th">MIN_FEAT_NUM1_FEAT_CAT1_A_3M</th>
<th data-quarto-table-cell-role="th">AVG_FEAT_NUM1_FEAT_CAT1_A_3M</th>
<th data-quarto-table-cell-role="th">SUM_FEAT_NUM2_FEAT_CAT1_A_3M</th>
<th data-quarto-table-cell-role="th">MAX_FEAT_NUM2_FEAT_CAT1_A_3M</th>
<th data-quarto-table-cell-role="th">MIN_FEAT_NUM2_FEAT_CAT1_A_3M</th>
<th data-quarto-table-cell-role="th">AVG_FEAT_NUM2_FEAT_CAT1_A_3M</th>
<th data-quarto-table-cell-role="th">SUM_FEAT_NUM1_FEAT_CAT1_A_6M</th>
<th data-quarto-table-cell-role="th">MAX_FEAT_NUM1_FEAT_CAT1_A_6M</th>
<th data-quarto-table-cell-role="th">MIN_FEAT_NUM1_FEAT_CAT1_A_6M</th>
<th data-quarto-table-cell-role="th">AVG_FEAT_NUM1_FEAT_CAT1_A_6M</th>
<th data-quarto-table-cell-role="th">SUM_FEAT_NUM2_FEAT_CAT1_A_6M</th>
<th data-quarto-table-cell-role="th">MAX_FEAT_NUM2_FEAT_CAT1_A_6M</th>
<th data-quarto-table-cell-role="th">MIN_FEAT_NUM2_FEAT_CAT1_A_6M</th>
<th data-quarto-table-cell-role="th">AVG_FEAT_NUM2_FEAT_CAT1_A_6M</th>
<th data-quarto-table-cell-role="th">SUM_FEAT_NUM1_FEAT_CAT1_B_3M</th>
<th data-quarto-table-cell-role="th">MAX_FEAT_NUM1_FEAT_CAT1_B_3M</th>
<th data-quarto-table-cell-role="th">MIN_FEAT_NUM1_FEAT_CAT1_B_3M</th>
<th data-quarto-table-cell-role="th">AVG_FEAT_NUM1_FEAT_CAT1_B_3M</th>
<th data-quarto-table-cell-role="th">SUM_FEAT_NUM2_FEAT_CAT1_B_3M</th>
<th data-quarto-table-cell-role="th">MAX_FEAT_NUM2_FEAT_CAT1_B_3M</th>
<th data-quarto-table-cell-role="th">MIN_FEAT_NUM2_FEAT_CAT1_B_3M</th>
<th data-quarto-table-cell-role="th">AVG_FEAT_NUM2_FEAT_CAT1_B_3M</th>
<th data-quarto-table-cell-role="th">SUM_FEAT_NUM1_FEAT_CAT1_B_6M</th>
<th data-quarto-table-cell-role="th">MAX_FEAT_NUM1_FEAT_CAT1_B_6M</th>
<th data-quarto-table-cell-role="th">MIN_FEAT_NUM1_FEAT_CAT1_B_6M</th>
<th data-quarto-table-cell-role="th">AVG_FEAT_NUM1_FEAT_CAT1_B_6M</th>
<th data-quarto-table-cell-role="th">SUM_FEAT_NUM2_FEAT_CAT1_B_6M</th>
<th data-quarto-table-cell-role="th">MAX_FEAT_NUM2_FEAT_CAT1_B_6M</th>
<th data-quarto-table-cell-role="th">MIN_FEAT_NUM2_FEAT_CAT1_B_6M</th>
<th data-quarto-table-cell-role="th">AVG_FEAT_NUM2_FEAT_CAT1_B_6M</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>4</td>
<td>2023-02-01</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>5</td>
<td>2023-02-01</td>
<td>75.0</td>
<td>75.0</td>
<td>75.0</td>
<td>75.0</td>
<td>71.0</td>
<td>71.0</td>
<td>71.0</td>
<td>71.0</td>
<td>75.0</td>
<td>75.0</td>
<td>75.0</td>
<td>75.0</td>
<td>71.0</td>
<td>71.0</td>
<td>71.0</td>
<td>71.0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>6</td>
<td>2023-02-01</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>7</td>
<td>2023-02-01</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>73.0</td>
<td>73.0</td>
<td>73.0</td>
<td>73.0</td>
<td>82.0</td>
<td>82.0</td>
<td>82.0</td>
<td>82.0</td>
<td>73.0</td>
<td>73.0</td>
<td>73.0</td>
<td>73.0</td>
<td>82.0</td>
<td>82.0</td>
<td>82.0</td>
<td>82.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>10</td>
<td>2023-02-01</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
</section>
<section id="snowflake" class="level2">
<h2 class="anchored" data-anchor-id="snowflake">3. Snowflake</h2>
<section id="criação-de-variáveis-numéricas" class="level3">
<h3 class="anchored" data-anchor-id="criação-de-variáveis-numéricas">Criação de variáveis numéricas</h3>
<p><span style="color: blue;">(EN)</span> The function <code>snow_create_query_num()</code> creates a query text for generating variables with the sum, minimum, maximum, and average operations on the variables listed in feat_num_lista and within the time window listed in list_window.</p>
<p><span style="color: green;">(PT)</span> A função <code>snow_create_query_num()</code> cria um texto com a query para a criação de variáveis com as operações soma, mínimo, máximo e média das variáveis listadas em feat_num_lista e com a janela de tempo listada em list_window.</p>
<div id="cell-85" class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>tb_publico <span class="op">=</span> <span class="st">'tb_spine'</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>tb_feat <span class="op">=</span> <span class="st">'tb_feat'</span></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a><span class="bu">id</span> <span class="op">=</span> <span class="st">'ID'</span></span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>safra_ref <span class="op">=</span> <span class="st">'SAFRA_REF'</span></span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>safra <span class="op">=</span> <span class="st">'SAFRA'</span></span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>feat_num_lista <span class="op">=</span> [<span class="st">'FEAT_NUM1'</span>,<span class="st">'FEAT_NUM2'</span>]</span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>list_window <span class="op">=</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>]</span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a>query_final_num_snow <span class="op">=</span> snow_create_query_num(tb_publico, tb_feat, list_window,feat_num_lista, <span class="bu">id</span>, safra_ref, safra)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Complete query creation with no saved file.</code></pre>
</div>
</div>
<p>Podemos salvar a consulta da query em um arquivo também:</p>
<div id="cell-87" class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>tb_publico <span class="op">=</span> <span class="st">'tb_spine'</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>tb_feat <span class="op">=</span> <span class="st">'tb_feat'</span></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a><span class="bu">id</span> <span class="op">=</span> <span class="st">'ID'</span></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>safra_ref <span class="op">=</span> <span class="st">'SAFRA_REF'</span></span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>safra <span class="op">=</span> <span class="st">'SAFRA'</span></span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>feat_num_lista <span class="op">=</span> [<span class="st">'FEAT_NUM1'</span>,<span class="st">'FEAT_NUM2'</span>]</span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a>list_window <span class="op">=</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>]</span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a>file_name <span class="op">=</span> <span class="st">'table.sql'</span></span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a>query_final_num_snow <span class="op">=</span> snow_create_query_num(tb_publico, tb_feat, list_window,feat_num_lista, <span class="bu">id</span>, safra_ref, safra, file_name)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Complete query creation with table.sql saved file</code></pre>
</div>
</div>
</section>
<section id="criação-de-variáveis-categóricas" class="level3">
<h3 class="anchored" data-anchor-id="criação-de-variáveis-categóricas">Criação de variáveis categóricas</h3>
<p><span style="color: blue;">(EN)</span> The function <code>mysql_create_query_cat()</code> generates a query text for creating variables with the mode of each variable listed in feat_num_lista within the time window provided in list_window.</p>
<p><span style="color: green;">(PT)</span> A função <code>mysql_create_query_cat()</code> cria um texto com a query para a criação de variáveis com a moda de cada uma das variáveis listadas em feat_num_lista na janela de tempo fornecida em list_window.</p>
<div id="cell-90" class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>tb_publico <span class="op">=</span> <span class="st">'tb_spine'</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>tb_feat <span class="op">=</span> <span class="st">'tb_feat'</span></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a><span class="bu">id</span> <span class="op">=</span> <span class="st">'ID'</span></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>safra_ref <span class="op">=</span> <span class="st">'SAFRA_REF'</span></span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>safra <span class="op">=</span> <span class="st">'SAFRA'</span></span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>feat_num_lista <span class="op">=</span> [<span class="st">'FEAT_CAT1'</span>,<span class="st">'FEAT_CAT2'</span>]</span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a>list_window <span class="op">=</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>]</span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a>query_final_cat_snow <span class="op">=</span> snow_create_query_cat(tb_publico, tb_feat, list_window, feat_num_lista, <span class="bu">id</span>, safra_ref, safra)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Complete query creation with no saved file.</code></pre>
</div>
</div>
<div id="cell-91" class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>tb_publico <span class="op">=</span> <span class="st">'tb_spine'</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>tb_feat <span class="op">=</span> <span class="st">'tb_feat'</span></span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a><span class="bu">id</span> <span class="op">=</span> <span class="st">'ID'</span></span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>safra_ref <span class="op">=</span> <span class="st">'SAFRA_REF'</span></span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>safra <span class="op">=</span> <span class="st">'SAFRA'</span></span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>feat_num_lista <span class="op">=</span> [<span class="st">'FEAT_CAT1'</span>,<span class="st">'FEAT_CAT2'</span>]</span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a>list_window <span class="op">=</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>]</span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a>file_name <span class="op">=</span> <span class="st">'table.sql'</span></span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-10"><a href="#cb69-10" aria-hidden="true" tabindex="-1"></a>query_final_cat_snow <span class="op">=</span> snow_create_query_cat(tb_publico, tb_feat, list_window, feat_num_lista, <span class="bu">id</span>, safra_ref, safra, file_name)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Complete query creation with table.sql saved file</code></pre>
</div>
</div>
</section>
<section id="criação-de-variáveis-agregadas" class="level3">
<h3 class="anchored" data-anchor-id="criação-de-variáveis-agregadas">Criação de variáveis agregadas</h3>
<p><span style="color: blue;">(EN)</span> We can create features by aggregating on a specific value of a categorical variable and calculating sum, avg, min, and max operations for user-defined numerical variables. For example, for the variable FEAT_CAT1 having a value of A or B, we calculate sum, avg, min, and max operations for the variables FEAT_NUM1 and FEAT_NUM2. Here’s a use case:</p>
<p><span style="color: green;">(PT)</span> Podemos criar variáveis agregando por valor específico de variável categórica e calculando as operações de sum, avg, min e max para as variáveis númericas definidas pelo usuário. Por exemplo, para a variável <code>FEAT_CAT1</code> tendo valor igual a <code>A</code> ou <code>B</code>, calculamos as operações de sum, avg, min e max para as variáveis <code>FEAT_NUM1</code> e <code>FEAT_NUM2</code>. Segue um caso de uso:</p>
<div id="cell-94" class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>lista_feat_num <span class="op">=</span> [<span class="st">'FEAT_NUM1'</span>, <span class="st">'FEAT_NUM2'</span>]</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>feat_cat <span class="op">=</span> <span class="st">'FEAT_CAT1'</span></span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>lista_valor_agragador <span class="op">=</span> [<span class="st">'B'</span>, <span class="st">'C'</span>]</span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a><span class="bu">id</span> <span class="op">=</span> <span class="st">'ID'</span></span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>safra_ref <span class="op">=</span> <span class="st">'SAFRA_REF'</span></span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>tb_feat <span class="op">=</span> <span class="st">'tb_feat'</span></span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a>safra <span class="op">=</span> <span class="st">'SAFRA'</span></span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a>janelas <span class="op">=</span> [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>]</span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a>tb_publico <span class="op">=</span> <span class="st">'tb_spine'</span></span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-11"><a href="#cb71-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-12"><a href="#cb71-12" aria-hidden="true" tabindex="-1"></a>query_final_cat_agre_snow <span class="op">=</span> snow_create_query_agregada(tb_publico, tb_feat, janelas,  lista_feat_num, <span class="bu">id</span>, safra_ref, safra, feat_cat, lista_valor_agragador)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Complete query creation with no saved file.</code></pre>
</div>
</div>
<p><span style="color: blue;">(EN)</span> We can also save the query to a file:</p>
<p><span style="color: green;">(PT)</span> Podemos também salvar a consulta em um arquivo:</p>
<div id="cell-96" class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>lista_feat_num <span class="op">=</span> [<span class="st">'FEAT_NUM1'</span>, <span class="st">'FEAT_NUM2'</span>]</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>feat_cat <span class="op">=</span> <span class="st">'FEAT_CAT1'</span></span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>lista_valor_agragador <span class="op">=</span> [<span class="st">'B'</span>, <span class="st">'C'</span>]</span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a><span class="bu">id</span> <span class="op">=</span> <span class="st">'ID'</span></span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>safra_ref <span class="op">=</span> <span class="st">'SAFRA_REF'</span></span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a>tb_feat <span class="op">=</span> <span class="st">'tb_feat'</span></span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a>safra <span class="op">=</span> <span class="st">'SAFRA'</span></span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a>janelas <span class="op">=</span> [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>]</span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a>tb_publico <span class="op">=</span> <span class="st">'tb_spine'</span></span>
<span id="cb73-10"><a href="#cb73-10" aria-hidden="true" tabindex="-1"></a>file_name <span class="op">=</span> <span class="st">'table.sql'</span></span>
<span id="cb73-11"><a href="#cb73-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-12"><a href="#cb73-12" aria-hidden="true" tabindex="-1"></a>query_final_cat_agre_snow <span class="op">=</span> snow_create_query_agregada(tb_publico, tb_feat, janelas,  lista_feat_num, <span class="bu">id</span>, safra_ref, safra, feat_cat, lista_valor_agragador, file_name)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Complete query creation with table.sql saved file</code></pre>
</div>
</div>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/ravennaro\.github\.io\/featsql");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/ravennaro/featsql/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></div></div></footer></body></html>